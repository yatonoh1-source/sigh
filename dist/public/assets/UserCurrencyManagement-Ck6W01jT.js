import{j as e}from"./ui-vendor-_s0klCrL.js";import{u as P,b as a}from"./react-vendor-C7VPsBAG.js";import{u as I,_ as q,C as l,h as u,a1 as B,i as m,j as h,k as x,B as t,A as M,I as b,am as $,r as A,a5 as H,aj as L,q as K}from"./index-BLJ_ytcB.js";import{D as O,a as G,b as Q,c as V,d as Y,e as _}from"./dialog-BPAt-TF-.js";import{P as z}from"./plus-k2bBbm5g.js";import{M as J}from"./minus-IziBK7bE.js";import"./utils-vendor-DYGWDIxX.js";function te(){const[,f]=P(),{isAdmin:S,isAuthenticated:k}=I(),{toast:s}=q(),[j,D]=a.useState(""),[i,U]=a.useState(""),[g,E]=a.useState(""),[T,c]=a.useState(!1),[n,R]=a.useState("add"),[d,y]=a.useState(""),[p,v]=a.useState(""),C=async()=>{if(!j.trim()){s({title:"Error",description:"Please enter a username to search",variant:"error"});return}try{const r=await fetch(`/api/admin/users/search?q=${encodeURIComponent(j)}`,{credentials:"include"});if(!r.ok)throw new Error("User not found");const w=await r.json();if(w.length===0){s({title:"Not Found",description:"No user found with that username",variant:"error"});return}const o=w[0];U(o.id),E(o.username),s({title:"User Found",description:`User: ${o.username} (Balance: ${o.currencyBalance||0} coins)`})}catch(r){s({title:"Error",description:r.message||"Failed to search user",variant:"error"})}},F=async()=>{if(!i){s({title:"Error",description:"Please select a user first",variant:"error"});return}if(!d||parseInt(d)<=0){s({title:"Error",description:"Please enter a valid amount",variant:"error"});return}if(!p.trim()){s({title:"Error",description:"Please provide a reason for this adjustment",variant:"error"});return}try{await L("POST",n==="add"?"/api/currency/admin/add":"/api/currency/admin/deduct",{userId:i,amount:parseInt(d),reason:p}),K.invalidateQueries({queryKey:["/api/currency/balance"]}),c(!1),y(""),v(""),s({title:"Success",description:`Currency ${n==="add"?"added":"deducted"} successfully`})}catch(r){s({title:"Error",description:r.message||"Failed to adjust currency",variant:"error"})}},N=r=>{if(!i){s({title:"Error",description:"Please search and select a user first",variant:"error"});return}R(r),c(!0)};return!k||!S?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 flex items-center justify-center p-4",children:e.jsxs(l,{className:"max-w-md w-full bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(u,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(B,{className:"w-8 h-8 text-primary"})}),e.jsx(m,{className:"text-2xl",children:"Admin Access Required"}),e.jsx(h,{className:"mt-2",children:"You need admin privileges to access user currency management"})]}),e.jsx(x,{children:e.jsx(t,{onClick:()=>f("/"),className:"w-full",children:"Return to Home"})})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(t,{variant:"ghost",onClick:()=>f("/admin"),className:"w-fit text-muted-foreground hover:text-primary mb-4",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"User Currency Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manually adjust user currency balances"})]}),e.jsxs(l,{children:[e.jsxs(u,{children:[e.jsx(m,{children:"Search User"}),e.jsx(h,{children:"Find a user by username to manage their currency"})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(b,{placeholder:"Enter username...",value:j,onChange:r=>D(r.target.value),onKeyDown:r=>r.key==="Enter"&&C()})}),e.jsxs(t,{onClick:C,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Search"]})]})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{children:[e.jsxs(u,{children:[e.jsx(m,{children:"Selected User"}),e.jsxs(h,{children:["User: ",g]})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(t,{onClick:()=>N("add"),className:"flex-1",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Add Currency"]}),e.jsxs(t,{onClick:()=>N("deduct"),variant:"destructive",className:"flex-1",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Deduct Currency"]})]})})]}),e.jsxs(l,{children:[e.jsxs(u,{children:[e.jsx(m,{children:"Recent Transactions"}),e.jsx(h,{children:"View currency transaction history for this user"})]}),e.jsx(x,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transaction history will appear here. Use the admin panel to view full details."})})]})]}),e.jsx(O,{open:T,onOpenChange:c,children:e.jsxs(G,{children:[e.jsxs(Q,{children:[e.jsxs(V,{children:[n==="add"?"Add":"Deduct"," Currency"]}),e.jsxs(Y,{children:[n==="add"?"Grant":"Remove"," currency ",n==="add"?"to":"from"," user: ",g]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"amount",children:"Amount"}),e.jsx(b,{id:"amount",type:"number",placeholder:"Enter amount",value:d,onChange:r=>y(r.target.value)})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"reason",children:"Reason"}),e.jsx(H,{id:"reason",placeholder:"Provide a reason for this adjustment...",value:p,onChange:r=>v(r.target.value),rows:3})]})]}),e.jsxs(_,{children:[e.jsx(t,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsxs(t,{onClick:F,children:[n==="add"?"Add":"Deduct"," Currency"]})]})]})})]})}export{te as default};
