import{j as e}from"./ui-vendor-_s0klCrL.js";import{u as P,b as q,L as I}from"./react-vendor-C7VPsBAG.js";import{u as M,b as $,C as t,h as n,a1 as H,i as d,j as c,k as r,B as o,aw as k,A,ak as C,g as p,an as D,ah as _,t as b}from"./index-BLJ_ytcB.js";import{L as Z,P as K,B as R,C as W,a as X,b as z,c as J,d as Q,e as V,A as Y,p as ee,f as se,g as ae}from"./chart-vendor-BWHaG5wj.js";import{A as S}from"./activity-Blw82mLV.js";import{D as te}from"./download-BAdLORKC.js";import{C as re}from"./chart-column-CWfcpHvH.js";import{T as ie}from"./trending-down-BwsJp3ld.js";import"./utils-vendor-DYGWDIxX.js";W.register(X,z,J,Q,V,Y,ee,se,ae);async function le(){const m=await fetch("/api/admin/analytics",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!m.ok)throw new Error("Failed to fetch analytics data");return m.json()}const ne=["#8884d8","#82ca9d","#ffc658","#ff7300","#8dd1e1","#d88884","#84d8c7"];function ge(){const{isAdmin:m,isAuthenticated:g}=M(),[,j]=P(),[L,f]=q.useState(!1),{data:a,isLoading:U,error:E,refetch:B,isRefetching:N}=$({queryKey:["admin-analytics"],queryFn:le,enabled:m&&g,refetchInterval:300*1e3});if(!g||!m)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 flex items-center justify-center p-4",children:e.jsxs(t,{className:"max-w-md w-full bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(n,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(H,{className:"w-8 h-8 text-primary"})}),e.jsx(d,{className:"text-2xl",children:"Admin Access Required"}),e.jsx(c,{className:"mt-2",children:"You need admin privileges to access analytics dashboard"})]}),e.jsx(r,{children:e.jsx(o,{onClick:()=>j("/"),className:"w-full",children:"Return to Home"})})]})});const G=async()=>{if(a){f(!0);try{const s={...a,exportedAt:new Date().toISOString(),exportedBy:"Admin Analytics Dashboard"},i=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),x=window.URL.createObjectURL(i),l=document.createElement("a");l.href=x,l.download=`analytics-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(x),document.body.removeChild(l),b({title:"Export Complete",description:"Analytics data has been exported successfully."})}catch{b({title:"Export Failed",description:"Failed to export analytics data.",variant:"error"})}finally{f(!1)}}},v=()=>{B(),b({title:"Refreshing Data",description:"Analytics data is being refreshed..."})},u=a?.userDistribution?.byRole?Object.entries(a.userDistribution.byRole).map(([s,i])=>({role:s.charAt(0).toUpperCase()+s.slice(1),count:i})):[],y=a?.seriesDistribution?.byStatus?Object.entries(a.seriesDistribution.byStatus).map(([s,i])=>({status:s.charAt(0).toUpperCase()+s.slice(1),count:i})):[],h=a?.genrePopularity?a.genrePopularity.slice(0,10).map(({genre:s,count:i})=>({genre:s,count:i})):[],w=s=>s>=0?e.jsx(D,{className:"w-4 h-4 text-green-600"}):e.jsx(ie,{className:"w-4 h-4 text-red-600"});return U?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"w-12 h-12 mx-auto mb-4 animate-spin text-primary"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Loading analytics data..."})]})})}):E?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg text-destructive mb-4",children:"Failed to load analytics data"}),e.jsxs(o,{onClick:v,variant:"outline",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Retry"]})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-2 sm:p-4",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs(o,{variant:"ghost",onClick:()=>j("/admin"),className:"w-full sm:w-fit text-muted-foreground hover:text-primary mb-4 min-h-11 justify-start",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(o,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(I,{href:"/admin",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Back to Admin"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-primary via-accent to-purple-400 bg-clip-text text-transparent",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Comprehensive insights and statistics for your AmourScans platform"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(o,{variant:"outline",onClick:v,disabled:N,children:[e.jsx(k,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),"Refresh"]}),e.jsxs(o,{variant:"outline",onClick:G,disabled:L,children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Export Data"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(t,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:a?.overview?.totalUsers||0}),e.jsxs("div",{className:"flex items-center mt-1",children:[w(a?.overview?.userGrowthRate||0),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:[Math.abs(a?.overview?.userGrowthRate||0).toFixed(1),"% growth"]})]})]}),e.jsx(C,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(t,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Series"}),e.jsx("p",{className:"text-2xl font-bold",children:a?.overview?.totalSeries||0}),e.jsxs("div",{className:"flex items-center mt-1",children:[w(a?.overview?.seriesGrowthRate||0),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:[Math.abs(a?.overview?.seriesGrowthRate||0).toFixed(1),"% growth"]})]})]}),e.jsx(p,{className:"w-8 h-8 text-orange-600"})]})})}),e.jsx(t,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"New Users (30d)"}),e.jsx("p",{className:"text-2xl font-bold",children:a?.overview?.newUsersLast30Days||0}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a?.overview?.newUsersLast7Days||0," in last 7 days"]})]}),e.jsx(D,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(t,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"New Series (30d)"}),e.jsx("p",{className:"text-2xl font-bold",children:a?.overview?.newSeriesLast30Days||0}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a?.overview?.newSeriesLast7Days||0," in last 7 days"]})]}),e.jsx(re,{className:"w-8 h-8 text-purple-600"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(t,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(n,{children:[e.jsx(d,{children:"Daily Activity (Last 30 Days)"}),e.jsx(c,{children:"User activity and page views over time"})]}),e.jsx(r,{children:e.jsx("div",{className:"h-80",children:e.jsx(Z,{data:{labels:(a?.dailyActivity||[]).map(s=>new Date(s.date).toLocaleDateString()),datasets:[{label:"Active Users",data:(a?.dailyActivity||[]).map(s=>s.users),borderColor:"#8884d8",backgroundColor:"rgba(136, 132, 216, 0.1)",tension:.4},{label:"Page Views",data:(a?.dailyActivity||[]).map(s=>s.views),borderColor:"#82ca9d",backgroundColor:"rgba(130, 202, 157, 0.1)",tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0}}}})})})]}),e.jsxs(t,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(n,{children:[e.jsx(d,{children:"User Distribution by Role"}),e.jsx(c,{children:"Breakdown of users by their assigned roles"})]}),e.jsx(r,{children:e.jsx("div",{className:"h-80",children:e.jsx(K,{data:{labels:u.map(s=>s.role),datasets:[{data:u.map(s=>s.count),backgroundColor:ne,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"},tooltip:{callbacks:{label:function(s){const i=s.label||"",x=s.parsed||0,l=s.dataset.data.reduce((O,T)=>O+T,0),F=(x/l*100).toFixed(0);return`${i}: ${x} (${F}%)`}}}}}})})})]}),e.jsxs(t,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(n,{children:[e.jsx(d,{children:"Series by Status"}),e.jsx(c,{children:"Distribution of series by publication status"})]}),e.jsx(r,{children:e.jsx("div",{className:"h-80",children:e.jsx(R,{data:{labels:y.map(s=>s.status),datasets:[{label:"Series Count",data:y.map(s=>s.count),backgroundColor:"#8884d8"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})})})]}),e.jsxs(t,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(n,{children:[e.jsx(d,{children:"Popular Genres"}),e.jsx(c,{children:"Top 10 most popular genres across all series"})]}),e.jsx(r,{children:e.jsx("div",{className:"h-80",children:h.length>0?e.jsx(R,{data:{labels:h.map(s=>s.genre),datasets:[{label:"Series Count",data:h.map(s=>s.count),backgroundColor:"#82ca9d"}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0}}}}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No genre data available"}),e.jsx("p",{className:"text-sm",children:"Add series with genres to see popularity"})]})})})})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs(t,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(n,{children:[e.jsx(d,{children:"Analytics Summary"}),e.jsx(c,{children:"Key insights from your AmourScans platform"})]}),e.jsx(r,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"User Growth"})]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:[Math.abs(a?.overview?.userGrowthRate||0).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"30-day growth rate"})]}),e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Content Growth"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 mt-2",children:[Math.abs(a?.overview?.seriesGrowthRate||0).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"30-day growth rate"})]}),e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium",children:"Popular Genres"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 mt-2",children:h.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active genres"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium",children:"User Roles"})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-600 mt-2",children:u.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Different roles"})]})]})})]})})]})})}export{ge as default};
