import{j as e}from"./ui-vendor-_s0klCrL.js";import{u as T,C as a,h as i,a1 as u,i as l,j,k as n,B as g,b as k,A as C,ak as B,aq as f,F as o}from"./index-BLJ_ytcB.js";import{u as H}from"./react-vendor-C7VPsBAG.js";import{T as L,a as S,b as p,c,d as D,e as d}from"./table-DVHEST2Z.js";import{A as R}from"./activity-Blw82mLV.js";import{j as I}from"./utils-vendor-DYGWDIxX.js";function J(){const{isAdmin:N,isAuthenticated:b}=T(),[,m]=H();if(!b||!N)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 flex items-center justify-center p-4",children:e.jsxs(a,{className:"max-w-md w-full bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(i,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(u,{className:"w-8 h-8 text-primary"})}),e.jsx(l,{className:"text-2xl",children:"Admin Access Required"}),e.jsx(j,{className:"mt-2",children:"You need admin privileges to access the security dashboard"})]}),e.jsx(n,{children:e.jsx(g,{onClick:()=>m("/"),className:"w-full",children:"Return to Home"})})]})});const{data:r=[],isLoading:v}=k({queryKey:["/api/admin/activity-logs"],refetchInterval:5e3}),h=s=>{try{return JSON.parse(s)}catch{return{}}},y=s=>{const t=s?.severity||"low",A={low:"bg-blue-500/10 text-blue-500",medium:"bg-yellow-500/10 text-yellow-500",high:"bg-orange-500/10 text-orange-500",critical:"bg-red-500/10 text-red-500"};return e.jsx(o,{className:A[t],children:t})},w=s=>s.includes("failed")||s.includes("unauthorized")?e.jsx(o,{variant:"destructive",children:s}):s.includes("success")||s.includes("created")?e.jsx(o,{variant:"default",className:"bg-green-500/10 text-green-500",children:s}):e.jsx(o,{variant:"secondary",children:s}),x={total:r.length,loginAttempts:r.filter(s=>s.action.includes("login")).length,failures:r.filter(s=>s.action.includes("failed")||s.action.includes("unauthorized")).length,suspicious:r.filter(s=>{const t=h(s.details);return t.severity==="high"||t.severity==="critical"}).length};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-2 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs(g,{variant:"ghost",onClick:()=>m("/admin"),className:"w-full sm:w-fit text-muted-foreground hover:text-primary mb-4 min-h-11 justify-start",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Security Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Real-time security monitoring and audit logs"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(a,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs(l,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Total Events"]})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 24 hours"})]})]}),e.jsxs(a,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs(l,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Login Attempts"]})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.loginAttempts}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All authentication"})]})]}),e.jsxs(a,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs(l,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4 text-orange-500"}),"Failures"]})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:x.failures}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Failed/Unauthorized"})]})]}),e.jsxs(a,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs(l,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4 text-red-500"}),"Suspicious"]})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-500",children:x.suspicious}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"High/Critical severity"})]})]})]}),e.jsxs(a,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Audit Logs"}),e.jsx(j,{children:"Real-time security events and administrative actions"})]}),e.jsx(n,{children:v?e.jsx("div",{className:"text-center py-8",children:"Loading security logs..."}):r.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No security events recorded"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(L,{children:[e.jsx(S,{children:e.jsxs(p,{children:[e.jsx(c,{children:"Timestamp"}),e.jsx(c,{children:"Action"}),e.jsx(c,{children:"Severity"}),e.jsx(c,{children:"Target"}),e.jsx(c,{children:"IP Address"}),e.jsx(c,{children:"Details"})]})}),e.jsx(D,{children:r.slice(0,50).map(s=>{const t=h(s.details);return e.jsxs(p,{children:[e.jsx(d,{className:"font-mono text-xs",children:I(new Date(s.createdAt),"MMM dd, HH:mm:ss")}),e.jsx(d,{children:w(s.action)}),e.jsx(d,{children:y(t)}),e.jsxs(d,{className:"font-mono text-xs",children:[s.targetType,s.targetId&&`:${s.targetId.slice(0,8)}`]}),e.jsx(d,{className:"font-mono text-xs",children:s.ipAddress}),e.jsx(d,{className:"max-w-xs truncate text-xs text-muted-foreground",children:t.reason||t.description||t.username||"-"})]},s.id)})})]})})})]})]})})}export{J as default};
