import{j as e}from"./ui-vendor-_s0klCrL.js";import{u as Z,b as m}from"./react-vendor-C7VPsBAG.js";import{u as ee,_ as se,ax as ae,b as ie,d as y,f as v,C as N,h as U,a1 as re,i as E,j as k,k as b,B as t,A as ne,ae as te,F as C,ah as ce,a0 as le,r as n,I as c,s as A,v as I,w as T,x as q,y as h,a5 as M}from"./index-BLJ_ytcB.js";import{D as O,a as L,b as Q,c as V,d as J,e as K}from"./dialog-BPAt-TF-.js";import{C as z}from"./crown-Cq9T_P0l.js";import{P as H}from"./plus-k2bBbm5g.js";import{S as oe}from"./square-pen-CRfgceVq.js";import"./utils-vendor-DYGWDIxX.js";function fe(){const{isAdmin:S,isAuthenticated:w}=ee(),[,P]=Z(),{toast:o}=se(),x=ae(),[R,d]=m.useState(!1),[Y,u]=m.useState(!1),[D,F]=m.useState(null),[a,r]=m.useState({name:"",description:"",priceUSD:"",billingCycle:"monthly",features:"",coinBonus:"0",discountPercentage:"0"}),{data:p,isLoading:$}=ie({queryKey:["/api/admin/subscriptions"],queryFn:async()=>{const s=await fetch("/api/admin/subscriptions",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch packages");return s.json()},enabled:S&&w}),g=y({mutationFn:async s=>{const i=await v("/api/admin/subscriptions",{method:"POST",body:JSON.stringify(s)});if(!i.ok){const l=await i.json();throw new Error(l.message||"Failed to create package")}return i.json()},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/admin/subscriptions"]}),o({title:"Success",description:"Subscription package created successfully"}),d(!1),B()},onError:s=>{o({title:"Error",description:s.message,variant:"error"})}}),j=y({mutationFn:async({id:s,data:i})=>{const l=await v(`/api/admin/subscriptions/${s}`,{method:"PUT",body:JSON.stringify(i)});if(!l.ok){const f=await l.json();throw new Error(f.message||"Failed to update package")}return l.json()},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/admin/subscriptions"]}),o({title:"Success",description:"Subscription package updated successfully"}),u(!1),F(null),B()},onError:s=>{o({title:"Error",description:s.message,variant:"error"})}}),W=y({mutationFn:async s=>{const i=await v(`/api/admin/subscriptions/${s}`,{method:"DELETE"});if(!i.ok){const l=await i.json();throw new Error(l.message||"Failed to delete package")}return i.json()},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/admin/subscriptions"]}),o({title:"Success",description:"Subscription package deleted successfully"})},onError:s=>{o({title:"Error",description:s.message,variant:"error"})}}),B=()=>{r({name:"",description:"",priceUSD:"",billingCycle:"monthly",features:"",coinBonus:"0",discountPercentage:"0"})},_=()=>{const s=a.features.split(`
`).filter(i=>i.trim());g.mutate({...a,priceUSD:a.priceUSD,coinBonus:parseInt(a.coinBonus),discountPercentage:parseInt(a.discountPercentage),features:s})},G=s=>{F(s);const i=typeof s.features=="string"?JSON.parse(s.features):s.features;r({name:s.name,description:s.description||"",priceUSD:s.priceUSD,billingCycle:s.billingCycle,features:Array.isArray(i)?i.join(`
`):"",coinBonus:s.coinBonus.toString(),discountPercentage:s.discountPercentage.toString()}),u(!0)},X=()=>{if(!D)return;const s=a.features.split(`
`).filter(i=>i.trim());j.mutate({id:D.id,data:{...a,priceUSD:a.priceUSD,coinBonus:parseInt(a.coinBonus),discountPercentage:parseInt(a.discountPercentage),features:s}})};return!w||!S?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 flex items-center justify-center p-4",children:e.jsxs(N,{className:"max-w-md w-full bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(re,{className:"w-8 h-8 text-primary"})}),e.jsx(E,{className:"text-2xl",children:"Admin Access Required"}),e.jsx(k,{className:"mt-2",children:"You need admin privileges to access subscription management"})]}),e.jsx(b,{children:e.jsx(t,{onClick:()=>P("/"),className:"w-full",children:"Return to Home"})})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>P("/admin"),children:e.jsx(ne,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold flex items-center gap-2",children:[e.jsx(z,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary"}),"VIP Subscription Management"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage subscription tiers and pricing"})]})]}),e.jsxs(t,{onClick:()=>d(!0),className:"w-full sm:w-auto",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Create Package"]})]}),$?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(s=>e.jsx(te,{className:"h-64"},s))}):p&&p.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.map(s=>{const i=typeof s.features=="string"?JSON.parse(s.features):s.features;return e.jsxs(N,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsx(U,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(E,{className:"text-xl",children:s.name}),e.jsx(k,{className:"mt-1",children:s.description})]}),e.jsx(C,{variant:"secondary",className:"ml-2",children:s.billingCycle})]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-3xl font-bold",children:["$",s.priceUSD]}),e.jsxs("span",{className:"text-muted-foreground",children:["/",s.billingCycle]})]}),Array.isArray(i)&&i.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Features:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[i.slice(0,3).map((l,f)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-3 h-3 text-primary"}),l]},f)),i.length>3&&e.jsxs("li",{className:"text-xs",children:["+",i.length-3," more..."]})]})]}),e.jsxs("div",{className:"flex gap-2 text-sm",children:[e.jsxs(C,{variant:"outline",children:["+",s.coinBonus," coins"]}),s.discountPercentage>0&&e.jsxs(C,{variant:"outline",children:[s.discountPercentage,"% off"]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>G(s),className:"flex-1",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"Edit"]}),e.jsxs(t,{variant:"destructive",size:"sm",onClick:()=>W.mutate(s.id),className:"flex-1",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"Delete"]})]})]})]},s.id)})}):e.jsx(N,{children:e.jsxs(b,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(z,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No subscription packages found"}),e.jsxs(t,{onClick:()=>d(!0),className:"mt-4",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Create First Package"]})]})})]}),e.jsx(O,{open:R,onOpenChange:d,children:e.jsxs(L,{className:"w-[95vw] max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Q,{children:[e.jsx(V,{children:"Create Subscription Package"}),e.jsx(J,{children:"Add a new VIP subscription tier"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Package Name *"}),e.jsx(c,{id:"name",value:a.name,onChange:s=>r({...a,name:s.target.value}),placeholder:"Premium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"priceUSD",children:"Price (USD) *"}),e.jsx(c,{id:"priceUSD",type:"number",step:"0.01",value:a.priceUSD,onChange:s=>r({...a,priceUSD:s.target.value}),placeholder:"9.99"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"description",children:"Description"}),e.jsx(c,{id:"description",value:a.description,onChange:s=>r({...a,description:s.target.value}),placeholder:"Best for regular readers"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"billingCycle",children:"Billing Cycle"}),e.jsxs(A,{value:a.billingCycle,onValueChange:s=>r({...a,billingCycle:s}),children:[e.jsx(I,{children:e.jsx(T,{})}),e.jsxs(q,{children:[e.jsx(h,{value:"monthly",children:"Monthly"}),e.jsx(h,{value:"yearly",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"coinBonus",children:"Coin Bonus"}),e.jsx(c,{id:"coinBonus",type:"number",value:a.coinBonus,onChange:s=>r({...a,coinBonus:s.target.value}),placeholder:"100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"discountPercentage",children:"Discount %"}),e.jsx(c,{id:"discountPercentage",type:"number",value:a.discountPercentage,onChange:s=>r({...a,discountPercentage:s.target.value}),placeholder:"10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"features",children:"Features (one per line)"}),e.jsx(M,{id:"features",value:a.features,onChange:s=>r({...a,features:s.target.value}),placeholder:`Ad-free reading
Early access to new chapters
Exclusive content`,rows:5})]})]}),e.jsxs(K,{children:[e.jsx(t,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(t,{onClick:_,disabled:g.isPending,children:g.isPending?"Creating...":"Create Package"})]})]})}),e.jsx(O,{open:Y,onOpenChange:u,children:e.jsxs(L,{className:"w-[95vw] max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Q,{children:[e.jsx(V,{children:"Edit Subscription Package"}),e.jsx(J,{children:"Update package details"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-name",children:"Package Name *"}),e.jsx(c,{id:"edit-name",value:a.name,onChange:s=>r({...a,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-priceUSD",children:"Price (USD) *"}),e.jsx(c,{id:"edit-priceUSD",type:"number",step:"0.01",value:a.priceUSD,onChange:s=>r({...a,priceUSD:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-description",children:"Description"}),e.jsx(c,{id:"edit-description",value:a.description,onChange:s=>r({...a,description:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-billingCycle",children:"Billing Cycle"}),e.jsxs(A,{value:a.billingCycle,onValueChange:s=>r({...a,billingCycle:s}),children:[e.jsx(I,{children:e.jsx(T,{})}),e.jsxs(q,{children:[e.jsx(h,{value:"monthly",children:"Monthly"}),e.jsx(h,{value:"yearly",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-coinBonus",children:"Coin Bonus"}),e.jsx(c,{id:"edit-coinBonus",type:"number",value:a.coinBonus,onChange:s=>r({...a,coinBonus:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-discountPercentage",children:"Discount %"}),e.jsx(c,{id:"edit-discountPercentage",type:"number",value:a.discountPercentage,onChange:s=>r({...a,discountPercentage:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-features",children:"Features (one per line)"}),e.jsx(M,{id:"edit-features",value:a.features,onChange:s=>r({...a,features:s.target.value}),rows:5})]})]}),e.jsxs(K,{children:[e.jsx(t,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(t,{onClick:X,disabled:j.isPending,children:j.isPending?"Updating...":"Update Package"})]})]})})]})}export{fe as default};
