import{j as e}from"./ui-vendor-_s0klCrL.js";import{u as K,b as R,L as Q}from"./react-vendor-C7VPsBAG.js";import{u as Y,b as B,C as n,h as j,a1 as L,i as u,j as y,k as l,B as t,F as c,L as x,ak as A,g as f,a3 as D,al as Z,am as _,an as ee,t as d}from"./index-BLJ_ytcB.js";import{A as G}from"./activity-Blw82mLV.js";import{C as I}from"./chart-column-CWfcpHvH.js";import{M as se}from"./monitor-C8b6Kadu.js";import{D as ae}from"./dollar-sign-xVsTkna1.js";import{D as U}from"./database-BaclKRYr.js";import{C as X}from"./circle-check-big-B1R9t0pA.js";import{F as te}from"./file-text-BFdtmCm2.js";import"./utils-vendor-DYGWDIxX.js";async function re(){const r=await fetch("/api/admin/stats",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error("Failed to fetch site statistics");return r.json()}async function ie(){const r=await fetch("/api/admin/recent-series",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error("Failed to fetch recent series");return r.json()}function ge(){const{isAdmin:r,isAuthenticated:g,isOwner:v,isStaff:S}=Y(),[,i]=K(),[O,$]=R.useState(!1),[F,M]=R.useState(!1),[T,q]=R.useState(!1),{data:H,isLoading:k,error:E}=B({queryKey:["admin-stats"],queryFn:re,enabled:r&&g}),{data:C,isLoading:V,error:z}=B({queryKey:["admin-recent-series"],queryFn:ie,enabled:r&&g});if(!g||!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 flex items-center justify-center p-4",children:e.jsxs(n,{className:"max-w-md w-full bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(j,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(L,{className:"w-8 h-8 text-primary"})}),e.jsx(u,{className:"text-2xl",children:"Admin Access Required"}),e.jsx(y,{className:"mt-2",children:g?"Your account does not have administrator privileges.":"Please log in with an administrator account to access the admin panel."})]}),e.jsx(l,{className:"flex flex-col gap-3",children:g?e.jsx(t,{onClick:()=>i("/"),className:"w-full",children:"Return to Home"}):e.jsxs(e.Fragment,{children:[e.jsx(t,{onClick:()=>i("/login"),className:"w-full",children:"Go to Login"}),e.jsx(t,{onClick:()=>i("/"),variant:"outline",className:"w-full",children:"Return to Home"})]})})]})});const p=H||{totalUsers:0,totalSeries:0,activeReaders:0,dailyViews:0},P=async()=>{$(!0);try{const s=await fetch("/api/admin/report",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(s.ok){const a=await s.json(),h=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),o=window.URL.createObjectURL(h),m=document.createElement("a");m.href=o,m.download=`admin-report-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(o),document.body.removeChild(m),d({title:"Report Generated",description:"Admin report has been downloaded successfully."})}else{const a=await s.json();d({title:"Error",description:a.message||"Failed to generate report",variant:"error"})}}catch{d({title:"Error",description:"Failed to generate report",variant:"error"})}finally{$(!1)}},W=async()=>{M(!0);try{const s=await fetch("/api/csrf-token",{credentials:"include"}),{csrfToken:a}=await s.json(),h=await fetch("/api/admin/backup",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","x-csrf-token":a},body:JSON.stringify({name:`admin-panel-backup-${new Date().toISOString().split("T")[0]}`})});if(h.ok){const o=await h.json();d({title:"Backup Created",description:`Database backup created: ${o.filename}`})}else{const o=await h.json();d({title:"Error",description:o.message||"Failed to create backup",variant:"error"})}}catch{d({title:"Error",description:"Failed to create backup",variant:"error"})}finally{M(!1)}},J=async()=>{q(!0);try{const s=await fetch("/api/admin/analytics",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(s.ok){const a=await s.json(),h=`
AmourScans Analytics Report
Generated: ${new Date().toLocaleString()}

Overview:
- Total Users: ${a.overview.totalUsers}
- Total Series: ${a.overview.totalSeries}
- New Users (30 days): ${a.overview.newUsersLast30Days}
- New Users (7 days): ${a.overview.newUsersLast7Days}
- User Growth Rate: ${a.overview.userGrowthRate}%
- Series Growth Rate: ${a.overview.seriesGrowthRate}%

User Distribution by Role:
${Object.entries(a.userDistribution.byRole).map(([N,w])=>`- ${N}: ${w}`).join(`
`)}

Series Distribution by Status:
${Object.entries(a.seriesDistribution.byStatus).map(([N,w])=>`- ${N}: ${w}`).join(`
`)}

Series Distribution by Type:
${Object.entries(a.seriesDistribution.byType).map(([N,w])=>`- ${N}: ${w}`).join(`
`)}
        `,o=new Blob([h],{type:"text/plain"}),m=window.URL.createObjectURL(o),b=document.createElement("a");b.href=m,b.download=`analytics-report-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(b),b.click(),window.URL.revokeObjectURL(m),document.body.removeChild(b),d({title:"Analytics Downloaded",description:"Analytics report has been downloaded successfully."})}else{const a=await s.json();d({title:"Error",description:a.message||"Failed to load analytics",variant:"error"})}}catch{d({title:"Error",description:"Failed to load analytics",variant:"error"})}finally{q(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-2 sm:p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 sm:justify-between mb-6 sm:mb-8",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Q,{href:"/",children:e.jsx(t,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-primary",children:"â† Back to AmourScans"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"w-8 h-8 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary via-accent to-purple-400 bg-clip-text text-transparent",children:"Admin Panel"}),v&&e.jsx(c,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-500 border-yellow-500/30",children:"Owner"}),!v&&r&&e.jsx(c,{variant:"secondary",className:"bg-primary/10 text-primary",children:"Administrator"}),!v&&!r&&S&&e.jsx(c,{variant:"secondary",className:"bg-blue-500/10 text-blue-500 border-blue-500/30",children:"Staff"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(n,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Users"}),k?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading..."})]}):e.jsx("p",{className:"text-2xl font-bold",children:p.totalUsers.toLocaleString()})]}),e.jsx(A,{className:"w-8 h-8 text-primary"})]})})}),e.jsx(n,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Series"}),k?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading..."})]}):e.jsx("p",{className:"text-2xl font-bold",children:p.totalSeries.toLocaleString()})]}),e.jsx(f,{className:"w-8 h-8 text-accent"})]})})}),e.jsx(n,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Readers"}),k?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading..."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:p.activeReaders.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Coming soon"})]})]}),e.jsx(G,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(n,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Daily Views"}),k?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading..."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:p.dailyViews.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Coming soon"})]})]}),e.jsx(I,{className:"w-8 h-8 text-purple-500"})]})})})]}),E&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"w-5 h-5 text-red-600"}),e.jsx("p",{className:"text-red-800 dark:text-red-200",children:"Failed to load statistics. Please refresh the page or try again later."})]})}),e.jsx("div",{className:"mb-8",children:e.jsxs(n,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(j,{children:[e.jsxs(u,{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 sm:justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{className:"w-5 h-5"}),e.jsx("span",{children:"Recent Series"})]}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>i("/admin/series"),children:"View All"})]}),e.jsx(y,{children:"Recently added series in your catalog"})]}),e.jsx(l,{children:V?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(x,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading series..."})]}):z?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(D,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{children:"Failed to load recent series"})]}):!C||C.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(f,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{children:"No series available"}),e.jsx(t,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>i("/admin/series"),children:"Add Your First Series"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:C.map(s=>e.jsxs("div",{className:"group",children:[e.jsx("div",{className:"aspect-[3/4] relative mb-2 bg-muted rounded-lg overflow-hidden",children:s.coverImageUrl?e.jsx("img",{src:s.coverImageUrl,alt:s.title,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:e.jsx(f,{className:"w-8 h-8 text-muted-foreground"})})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold text-sm leading-tight line-clamp-2",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:s.genres?Array.isArray(s.genres)?s.genres.slice(0,2).join(", "):s.genres.split(",").slice(0,2).join(", "):"No genres"}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx(c,{variant:"secondary",className:"text-xs",children:s.status})})]})]},s.id))})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(n,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(j,{children:[e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-5 h-5"}),e.jsx("span",{children:"Administration"})]}),e.jsx(y,{children:"Manage users, content, and system settings"})]}),e.jsx(l,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(t,{variant:"outline",className:"h-auto p-6 flex flex-col items-start space-y-2",onClick:()=>i("/admin/users"),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-semibold",children:"User Management"})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"View, edit, and manage user accounts"})]}),v&&e.jsxs(t,{variant:"outline",className:"h-auto p-6 flex flex-col items-start space-y-2 border-primary/30",onClick:()=>i("/admin/role-authority"),children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-semibold",children:"Role Authority"})]}),e.jsx(c,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-500 border-yellow-500/30 text-xs",children:"Owner"})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"Manage roles and permissions"})]}),e.jsxs(t,{variant:"outline",className:"h-auto p-6 flex flex-col items-start space-y-2",onClick:()=>i("/admin/series"),children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{className:"w-5 h-5 text-accent"}),e.jsx("span",{className:"font-semibold",children:"Content Management"})]}),S&&!r&&e.jsx(c,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-500 text-xs",children:"Read-only"})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-left",children:S&&!r?"View manga series (Staff)":"Add, edit, and organize manga series"})]}),e.jsxs(t,{variant:"outline",className:"h-auto p-6 flex flex-col items-start space-y-2",onClick:()=>i("/admin/analytics"),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{className:"font-semibold",children:"Analytics"})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"View site statistics and reports"})]}),e.jsxs(t,{variant:"outline",className:"h-auto p-6 flex flex-col items-start space-y-2",onClick:()=>i("/admin/seo"),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"font-semibold",children:"SEO Management"})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"Manage meta tags, optimize search rankings"})]}),e.jsxs(t,{variant:"outline",className:"h-auto p-6 flex flex-col items-start space-y-2",onClick:()=>i("/admin/ads"),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{className:"font-semibold",children:"Ad Management"})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"Create and manage site advertisements"})]}),e.jsxs(t,{variant:"outline",className:"h-auto p-6 flex flex-col items-start space-y-2",onClick:()=>i("/admin/monetization"),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"w-5 h-5 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:"Monetization Dashboard"})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"Manage revenue, subscriptions, and currency"})]})]})})]}),e.jsxs(n,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(j,{children:[e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{children:"System Status"})]}),e.jsx(y,{children:"Current system health and performance"})]}),e.jsx(l,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium",children:"Database"})]}),e.jsx(c,{className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",children:"Healthy"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium",children:"Server"})]}),e.jsx(c,{className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",children:"Online"})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(j,{children:[e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-5 h-5"}),e.jsx("span",{children:"System Information"})]}),e.jsx(y,{children:"Live data from your AmourScans instance"})]}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Database Status"})]}),e.jsx(c,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:"Connected"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium",children:"User Accounts"})]}),e.jsx("span",{className:"text-sm font-bold",children:p.totalUsers})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Series Catalog"})]}),e.jsx("span",{className:"text-sm font-bold",children:p.totalSeries})]}),E&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"API Status"})]}),e.jsx(c,{variant:"secondary",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",children:"Error"})]})]})]}),e.jsxs(n,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsx(j,{children:e.jsx(u,{children:"Quick Actions"})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs(t,{variant:"outline",className:"w-full justify-start",onClick:P,disabled:O,children:[O?e.jsx(x,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(te,{className:"w-4 h-4 mr-2"}),"Generate Report"]}),e.jsxs(t,{variant:"outline",className:"w-full justify-start",onClick:W,disabled:F,children:[F?e.jsx(x,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(U,{className:"w-4 h-4 mr-2"}),"Backup Database"]}),e.jsxs(t,{variant:"outline",className:"w-full justify-start",onClick:J,disabled:T,children:[T?e.jsx(x,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ee,{className:"w-4 h-4 mr-2"}),"View Analytics"]})]})]})]})]})]})})}export{ge as default};
