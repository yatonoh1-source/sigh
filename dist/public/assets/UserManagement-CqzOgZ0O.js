import{j as e}from"./ui-vendor-_s0klCrL.js";import{u as ve,b as i,L as fe}from"./react-vendor-C7VPsBAG.js";import{c as Ne,u as we,t as n,C as O,h as Z,a1 as _,i as ee,j as se,k as T,B as l,A as be,ak as ye,am as Ce,I as h,s as C,v as k,w as S,x as U,y as t,F as g,l as ke,m as Se,n as Ue,U as ae,M as Ae,ao as De,r as m,ap as Fe,aq as I,a0 as Ee,Y as Re,ah as Be}from"./index-BLJ_ytcB.js";import{D as $,f as Le,a as V,b as z,c as J,d as Q}from"./dialog-BPAt-TF-.js";import{A as Oe,a as Te,b as qe,c as We,d as Me,e as Pe,f as Xe,g as He}from"./alert-dialog-CQ2ww59i.js";import{M as Ie}from"./map-pin-DBn9lb12.js";import{S as $e}from"./square-pen-CRfgceVq.js";import{S as Ve}from"./save-0LRYMEmV.js";import{C as ze}from"./circle-check-big-B1R9t0pA.js";import{C as re}from"./crown-Cq9T_P0l.js";import"./utils-vendor-DYGWDIxX.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=Ne("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);function ds(){const{isAdmin:c,isAuthenticated:ne,user:A,isOwner:o,isStaff:x}=we(),[,te]=ve(),[p,D]=i.useState([]),[ie,Y]=i.useState(!0),[v,le]=i.useState(""),[G,W]=i.useState(null),[f,u]=i.useState({}),[M,P]=i.useState(null),[F,E]=i.useState(null),[Je,Qe]=i.useState([]),[b,N]=i.useState({reason:"",severity:"low",notes:""}),[Ye,Ge]=i.useState(null),[Ke,Ze]=i.useState(!1),[y,R]=i.useState(null),[j,w]=i.useState({banReason:"",duration:0}),[X,ce]=i.useState("all"),[B,oe]=i.useState("all"),L=i.useCallback(async()=>{try{Y(!0);const s=await fetch("/api/admin/users",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(s.ok){const a=await s.json();D(a)}else n({title:"Error",description:"Failed to fetch users",variant:"error"})}catch{n({title:"Error",description:"Failed to fetch users",variant:"error"})}finally{Y(!1)}},[n]);i.useEffect(()=>{L()},[L]);const de=s=>{W(s),u({username:s.username,email:s.email,firstName:s.firstName,lastName:s.lastName,country:s.country})},me=async()=>{if(G)try{const s=await fetch(`/api/admin/users/${G.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(f)});if(s.ok)n({title:"Success",description:"User updated successfully"}),W(null),u({}),L();else{const a=await s.json();n({title:"Error",description:a.message||"Failed to update user",variant:"error"})}}catch{n({title:"Error",description:"Failed to update user",variant:"error"})}},xe=async s=>{try{const a=await fetch(`/api/admin/users/${s}`,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest"}});if(a.ok)n({title:"Success",description:"User deleted successfully"}),P(null),L();else{const r=await a.json();n({title:"Error",description:r.message||"Failed to delete user",variant:"error"})}}catch{n({title:"Error",description:"Failed to delete user",variant:"error"})}},he=async(s,a)=>{try{const r=await fetch(`/api/admin/users/${s}/role`,{method:"PATCH",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({role:a})});if(r.ok){const d=await r.json();D(p.map(H=>H.id===s?{...H,role:a,isAdmin:a==="admin"||a==="owner"}:H)),n({title:"Success",description:`User role changed to ${a}.`})}else{const d=await r.json();throw new Error(d.message||"Failed to update role")}}catch(r){n({title:"Error",description:r instanceof Error?r.message:"Failed to update user role. Please try again.",variant:"error"})}},ue=async()=>{if(F){if(!b.reason.trim()){n({title:"Error",description:"Warning reason is required",variant:"error"});return}try{const s=await fetch(`/api/admin/users/${F.id}/warn`,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(b)});if(s.ok)n({title:"Success",description:"Warning issued successfully"}),E(null),N({reason:"",severity:"low",notes:""});else{const a=await s.json();n({title:"Error",description:a.message||"Failed to issue warning",variant:"error"})}}catch{n({title:"Error",description:"Failed to issue warning",variant:"error"})}}},je=async()=>{if(y){if(!j.banReason.trim()){n({title:"Error",description:"Ban reason is required",variant:"error"});return}try{const s=await fetch(`/api/admin/users/${y.id}/ban`,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(j)});if(s.ok){const a=await s.json();D(p.map(r=>r.id===y.id?a:r)),n({title:"Success",description:"User banned successfully"}),R(null),w({banReason:"",duration:0})}else{const a=await s.json();n({title:"Error",description:a.message||"Failed to ban user",variant:"error"})}}catch{n({title:"Error",description:"Failed to ban user",variant:"error"})}}},ge=async s=>{try{const a=await fetch(`/api/admin/users/${s}/unban`,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}});if(a.ok){const r=await a.json();D(p.map(d=>d.id===s?r:d)),n({title:"Success",description:"User unbanned successfully"})}else{const r=await a.json();n({title:"Error",description:r.message||"Failed to unban user",variant:"error"})}}catch{n({title:"Error",description:"Failed to unban user",variant:"error"})}},pe=(s,a)=>{switch(s||(a?"admin":"user")){case"owner":return e.jsxs(g,{className:"bg-gradient-to-r from-yellow-400 to-orange-500 text-white border-2 border-yellow-300 shadow-lg",children:[e.jsx(re,{className:"w-3 h-3 mr-1 fill-current"}),"Owner"]});case"admin":return e.jsxs(g,{className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),"Admin"]});case"staff":return e.jsxs(g,{className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"Staff"]});case"premium":return e.jsxs(g,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:[e.jsx(Be,{className:"w-3 h-3 mr-1"}),"Premium"]});case"user":default:return e.jsxs(g,{variant:"secondary",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"User"]})}},K=p.filter(s=>{const a=s.username?.toLowerCase().includes(v.toLowerCase())||s.email?.toLowerCase().includes(v.toLowerCase())||s.firstName?.toLowerCase().includes(v.toLowerCase())||s.lastName?.toLowerCase().includes(v.toLowerCase()),r=X==="all"||(s.role||(s.isAdmin?"admin":"user"))===X,d=B==="all"||B==="banned"&&s.isBanned==="true"||B==="active"&&s.isBanned!=="true";return a&&r&&d});return!ne||!c?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 flex items-center justify-center p-4",children:e.jsxs(O,{className:"max-w-md w-full bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(Z,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(_,{className:"w-8 h-8 text-primary"})}),e.jsx(ee,{className:"text-2xl",children:"Admin Access Required"}),e.jsx(se,{className:"mt-2",children:"You need admin privileges to access user management"})]}),e.jsx(T,{children:e.jsx(l,{onClick:()=>te("/"),className:"w-full",children:"Return to Home"})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-2 sm:p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 sm:mb-8 gap-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(fe,{href:"/admin",children:e.jsxs(l,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-primary",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Back to Admin Panel"]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"w-8 h-8 text-primary"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-primary via-accent to-purple-400 bg-clip-text text-transparent",children:"User Management"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx(O,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search users by username, email, or name...",value:v,onChange:s=>le(s.target.value),className:"pl-10 bg-background/50"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{value:X,onValueChange:ce,children:[e.jsx(k,{className:"w-32 bg-background/50",children:e.jsx(S,{placeholder:"Role"})}),e.jsxs(U,{children:[e.jsx(t,{value:"all",children:"All Roles"}),e.jsx(t,{value:"user",children:"User"}),e.jsx(t,{value:"premium",children:"Premium"}),e.jsx(t,{value:"staff",children:"Staff"}),e.jsx(t,{value:"admin",children:"Admin"}),e.jsx(t,{value:"owner",children:"Owner"})]})]}),e.jsxs(C,{value:B,onValueChange:oe,children:[e.jsx(k,{className:"w-32 bg-background/50",children:e.jsx(S,{placeholder:"Status"})}),e.jsxs(U,{children:[e.jsx(t,{value:"all",children:"All Users"}),e.jsx(t,{value:"active",children:"Active"}),e.jsx(t,{value:"banned",children:"Banned"})]})]})]})]})})})}),e.jsx(O,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:p.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Users"})]})})})]}),e.jsxs(O,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(Z,{children:[e.jsxs(ee,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"All Users"}),x&&!o&&!c&&e.jsx(g,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-500 text-xs",children:"Read-only (Staff)"})]}),e.jsx(se,{children:x&&!o&&!c?"View user information (Staff have read-only access)":"Manage user accounts and permissions"})]}),e.jsx(T,{children:ie?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading users..."})}):K.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:v?"No users found matching your search.":"No users found."})}):e.jsx("div",{className:"space-y-4",children:K.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-background/50 rounded-lg border border-border/50",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(ke,{className:"w-12 h-12",children:[e.jsx(Se,{src:s.profileImageUrl||s.profilePicture||void 0}),e.jsx(Ue,{className:"bg-primary/10 text-primary",children:(s.firstName?.[0]||s.username?.[0]||"U").toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-wrap",children:[e.jsx("p",{className:"font-medium truncate",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.username||"No name"}),pe(s.role,s.isAdmin),s.isBanned==="true"&&e.jsxs(g,{variant:"destructive",className:"text-xs",children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),"Banned"]})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-sm text-muted-foreground",children:[s.username&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ae,{className:"w-3 h-3"}),e.jsx("span",{children:s.username})]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-48",children:s.email})]}),s.country&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ie,{className:"w-3 h-3"}),e.jsx("span",{children:s.country})]}),s.createdAt&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(De,{className:"w-3 h-3"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(C,{value:s.role||(s.isAdmin?"admin":"user"),disabled:!o,onValueChange:a=>{if(a==="owner"){if(A?.role!=="owner"){n({title:"Access Denied",description:"Only the current owner can assign owner privileges.",variant:"error"});return}if(p.find(d=>d.role==="owner"&&d.id!==s.id)){n({title:"Error",description:"Only one owner can exist at a time. Please demote the current owner first.",variant:"error"});return}}if(A?.id===s.id&&A?.role==="owner"&&a!=="owner"){n({title:"Access Denied",description:"Owners cannot demote themselves. Transfer ownership to another user first.",variant:"error"});return}he(s.id,a)},children:[e.jsx(k,{className:"w-24 h-8 text-xs",children:e.jsx(S,{})}),e.jsxs(U,{children:[e.jsx(t,{value:"user",children:"User"}),e.jsx(t,{value:"premium",children:"Premium"}),e.jsx(t,{value:"staff",children:"Staff"}),e.jsx(t,{value:"admin",children:"Admin"}),A?.role==="owner"&&e.jsx(t,{value:"owner",children:"Owner"})]})]}),e.jsxs($,{children:[e.jsx(Le,{asChild:!0,children:e.jsx(l,{variant:"outline",size:"sm",onClick:()=>de(s),disabled:x&&!o&&!c,title:x&&!o&&!c?"Staff have read-only access":"Edit user",children:e.jsx($e,{className:"w-4 h-4"})})}),e.jsxs(V,{className:"w-[95vw] sm:max-w-[525px]",children:[e.jsxs(z,{children:[e.jsx(J,{children:"Edit User"}),e.jsx(Q,{children:"Update user information and settings."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"firstName",children:"First Name"}),e.jsx(h,{id:"firstName",value:f.firstName||"",onChange:a=>u(r=>({...r,firstName:a.target.value})),className:"bg-background/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"lastName",children:"Last Name"}),e.jsx(h,{id:"lastName",value:f.lastName||"",onChange:a=>u(r=>({...r,lastName:a.target.value})),className:"bg-background/50"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"username",children:"Username"}),e.jsx(h,{id:"username",value:f.username||"",onChange:a=>u(r=>({...r,username:a.target.value})),className:"bg-background/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:f.email||"",onChange:a=>u(r=>({...r,email:a.target.value})),className:"bg-background/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"country",children:"Country"}),e.jsx(h,{id:"country",value:f.country||"",onChange:a=>u(r=>({...r,country:a.target.value})),className:"bg-background/50"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs(l,{variant:"outline",onClick:()=>W(null),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(l,{onClick:me,children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>E(s),disabled:x&&!o&&!c,title:"Issue warning",className:"text-yellow-500 hover:text-yellow-600",children:e.jsx(I,{className:"w-4 h-4"})}),s.isBanned==="true"?e.jsx(l,{variant:"outline",size:"sm",onClick:()=>ge(s.id),disabled:x&&!o&&!c,title:"Unban user",className:"text-green-500 hover:text-green-600",children:e.jsx(ze,{className:"w-4 h-4"})}):e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{R(s),w({banReason:"",duration:0})},disabled:x&&!o&&!c,title:"Ban user",className:"text-red-500 hover:text-red-600",children:e.jsx(q,{className:"w-4 h-4"})}),!s.isAdmin&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>P(s.id),className:"text-destructive hover:text-destructive",disabled:x&&!o&&!c,title:x&&!o&&!c?"Staff have read-only access":"Delete user",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]},s.id))})})]}),e.jsx(Oe,{open:!!M,onOpenChange:()=>P(null),children:e.jsxs(Te,{children:[e.jsxs(qe,{children:[e.jsx(We,{children:"Delete User"}),e.jsx(Me,{children:"Are you sure you want to delete this user? This action cannot be undone."})]}),e.jsxs(Pe,{children:[e.jsx(Xe,{children:"Cancel"}),e.jsx(He,{onClick:()=>M&&xe(M),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete User"})]})]})}),e.jsx($,{open:!!F,onOpenChange:()=>{E(null),N({reason:"",severity:"low",notes:""})},children:e.jsxs(V,{className:"w-[95vw] sm:max-w-[500px]",children:[e.jsxs(z,{children:[e.jsxs(J,{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{children:"Issue Warning"})]}),e.jsxs(Q,{children:["Issue a warning to ",F?.username||"this user"]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"warning-reason",children:"Reason *"}),e.jsx(h,{id:"warning-reason",placeholder:"Enter warning reason...",value:b.reason,onChange:s=>N(a=>({...a,reason:s.target.value})),className:"bg-background/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"warning-severity",children:"Severity"}),e.jsxs(C,{value:b.severity,onValueChange:s=>N(a=>({...a,severity:s})),children:[e.jsx(k,{className:"bg-background/50",children:e.jsx(S,{})}),e.jsxs(U,{children:[e.jsx(t,{value:"low",children:"Low"}),e.jsx(t,{value:"medium",children:"Medium"}),e.jsx(t,{value:"high",children:"High"}),e.jsx(t,{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"warning-notes",children:"Additional Notes (Optional)"}),e.jsx(h,{id:"warning-notes",placeholder:"Additional context...",value:b.notes,onChange:s=>N(a=>({...a,notes:s.target.value})),className:"bg-background/50"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{E(null),N({reason:"",severity:"low",notes:""})},children:"Cancel"}),e.jsxs(l,{onClick:ue,className:"bg-yellow-500 hover:bg-yellow-600",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Issue Warning"]})]})]})}),e.jsx($,{open:!!y,onOpenChange:()=>{R(null),w({banReason:"",duration:0})},children:e.jsxs(V,{className:"w-[95vw] sm:max-w-[500px]",children:[e.jsxs(z,{children:[e.jsxs(J,{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{children:"Ban User"})]}),e.jsxs(Q,{children:["Ban ",y?.username||"this user"," from accessing the platform"]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"ban-reason",children:"Ban Reason *"}),e.jsx(h,{id:"ban-reason",placeholder:"Enter ban reason...",value:j.banReason,onChange:s=>w(a=>({...a,banReason:s.target.value})),className:"bg-background/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"ban-duration",children:"Ban Duration"}),e.jsxs(C,{value:j.duration.toString(),onValueChange:s=>w(a=>({...a,duration:parseInt(s)})),children:[e.jsx(k,{className:"bg-background/50",children:e.jsx(S,{})}),e.jsxs(U,{children:[e.jsx(t,{value:"0",children:"Permanent"}),e.jsx(t,{value:"1",children:"1 Day"}),e.jsx(t,{value:"3",children:"3 Days"}),e.jsx(t,{value:"7",children:"7 Days"}),e.jsx(t,{value:"14",children:"14 Days"}),e.jsx(t,{value:"30",children:"30 Days"}),e.jsx(t,{value:"90",children:"90 Days"})]})]})]}),j.duration>0&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground bg-blue-500/10 p-3 rounded-md",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsxs("span",{children:["Ban will expire in ",j.duration," day",j.duration!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{R(null),w({banReason:"",duration:0})},children:"Cancel"}),e.jsxs(l,{onClick:je,variant:"destructive",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Ban User"]})]})]})})]})})}export{ds as default};
