import{j as e}from"./ui-vendor-_s0klCrL.js";import{u as W,b as g}from"./react-vendor-C7VPsBAG.js";import{u as Y,_ as Z,ax as _,b as k,d as N,f as w,C as S,h as G,a1 as X,i as ee,j as ae,k as E,B as c,ae as I,A as se,F as P,Y as te,aP as re,a0 as ie,r as n,I as l,a5 as A,s as ne,v as ce,w as le,x as de,y as oe}from"./index-BLJ_ytcB.js";import{D as q,a as L,b as O,c as U,d as $,e as M}from"./dialog-BPAt-TF-.js";import{P as B}from"./plus-k2bBbm5g.js";import{Z as me}from"./zap-JsjwqhbD.js";import{P as he}from"./percent-Bdg2aQgN.js";import{S as xe}from"./square-pen-CRfgceVq.js";import"./utils-vendor-DYGWDIxX.js";function we(){const{isAdmin:u,isAuthenticated:p}=Y(),[,C]=W(),{toast:o}=Z(),j=_(),[H,m]=g.useState(!1),[K,h]=g.useState(!1),[D,T]=g.useState(null),[s,t]=g.useState({name:"",description:"",targetId:"",discountPercentage:"20",startTime:"",endTime:"",maxPurchases:""}),{data:y,isLoading:Q}=k({queryKey:["/api/admin/flash-sales"],queryFn:async()=>{const a=await fetch("/api/admin/flash-sales",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch flash sales");return a.json()},enabled:u&&p}),{data:x}=k({queryKey:["/api/currency/packages"],queryFn:async()=>{const a=await fetch("/api/currency/packages",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch packages");return a.json()},enabled:u&&p}),b=N({mutationFn:async a=>{const r=await w("/api/admin/flash-sales/create",{method:"POST",body:JSON.stringify(a)});if(!r.ok){const i=await r.json();throw new Error(i.message||"Failed to create flash sale")}return r.json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/admin/flash-sales"]}),o({title:"Success",description:"Flash sale created successfully"}),m(!1),F()},onError:a=>{o({title:"Error",description:a.message,variant:"error"})}}),f=N({mutationFn:async({id:a,data:r})=>{const i=await w(`/api/admin/flash-sales/${a}`,{method:"PATCH",body:JSON.stringify(r)});if(!i.ok){const d=await i.json();throw new Error(d.message||"Failed to update flash sale")}return i.json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/admin/flash-sales"]}),o({title:"Success",description:"Flash sale updated successfully"}),h(!1),T(null)},onError:a=>{o({title:"Error",description:a.message,variant:"error"})}}),z=N({mutationFn:async a=>{const r=await w(`/api/admin/flash-sales/${a}`,{method:"DELETE",credentials:"include"});if(!r.ok)throw new Error("Failed to delete flash sale");return r.json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/admin/flash-sales"]}),o({title:"Success",description:"Flash sale deleted successfully"})},onError:a=>{o({title:"Error",description:a.message,variant:"error"})}}),F=()=>{t({name:"",description:"",targetId:"",discountPercentage:"20",startTime:"",endTime:"",maxPurchases:""})},R=()=>{if(!s.targetId||!s.startTime||!s.endTime){o({title:"Error",description:"Please fill in all required fields",variant:"error"});return}const a=x?.find(v=>v.id===s.targetId);if(!a)return;const r=parseFloat(a.priceUSD),i=parseFloat(s.discountPercentage)/100,d=(r*(1-i)).toFixed(2);b.mutate({name:s.name||`${a.name} Flash Sale`,description:s.description||null,type:"coin_package",targetId:s.targetId,discountPercentage:parseInt(s.discountPercentage),originalPrice:a.priceUSD,salePrice:d,startTime:new Date(s.startTime).toISOString(),endTime:new Date(s.endTime).toISOString(),maxPurchases:s.maxPurchases?parseInt(s.maxPurchases):null})},V=a=>{T(a),t({name:a.name,description:a.description||"",targetId:a.targetId||"",discountPercentage:a.discountPercentage.toString(),startTime:new Date(a.startTime).toISOString().slice(0,16),endTime:new Date(a.endTime).toISOString().slice(0,16),maxPurchases:a.maxPurchases?.toString()||""}),h(!0)},J=()=>{if(!D)return;const a=x?.find(v=>v.id===s.targetId);if(!a)return;const r=parseFloat(a.priceUSD),i=parseFloat(s.discountPercentage)/100,d=(r*(1-i)).toFixed(2);f.mutate({id:D.id,data:{name:s.name,description:s.description||null,discountPercentage:parseInt(s.discountPercentage),salePrice:d,startTime:new Date(s.startTime).toISOString(),endTime:new Date(s.endTime).toISOString(),maxPurchases:s.maxPurchases?parseInt(s.maxPurchases):null}})};return!p||!u?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 flex items-center justify-center p-4",children:e.jsxs(S,{className:"max-w-md w-full bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(G,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(X,{className:"w-8 h-8 text-primary"})}),e.jsx(ee,{className:"text-2xl",children:"Admin Access Required"}),e.jsx(ae,{className:"mt-2",children:"You need admin privileges to access flash sales management"})]}),e.jsx(E,{children:e.jsx(c,{onClick:()=>C("/"),className:"w-full",children:"Return to Home"})})]})}):Q?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-black to-gray-900 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(I,{className:"h-12 w-96 mb-8 bg-gray-800"}),e.jsx("div",{className:"grid gap-6",children:[1,2,3].map(a=>e.jsx(I,{className:"h-32 bg-gray-800"},a))})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-black to-gray-900 p-2 sm:p-4 md:p-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(c,{variant:"ghost",onClick:()=>C("/admin/monetization"),className:"text-gray-400 hover:text-white mb-4 min-h-11 w-full sm:w-auto justify-start",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Back to Monetization"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-white mb-2",children:"Flash Sales Management"}),e.jsx("p",{className:"text-gray-400",children:"Create and manage limited-time offers"})]}),e.jsxs(c,{onClick:()=>{F(),m(!0)},className:"bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Create Flash Sale"]})]})]}),e.jsx("div",{className:"grid gap-6",children:!y||y.length===0?e.jsxs(S,{className:"bg-gray-900/50 border-gray-800 text-center p-16",children:[e.jsx(me,{className:"w-16 h-16 mx-auto mb-4 text-gray-600"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"No Flash Sales"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Create your first flash sale to boost revenue"}),e.jsxs(c,{onClick:()=>m(!0),className:"bg-primary",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Create Flash Sale"]})]}):y.map(a=>{const r=a.isActive==="true",i=new Date(a.startTime)<=new Date,d=new Date(a.endTime)<=new Date;return a.maxPurchases&&(a.maxPurchases-a.currentPurchases)/a.maxPurchases*100,e.jsx(S,{className:`bg-gray-900/50 border-gray-800 ${r&&i&&!d?"border-red-500/30":""}`,children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:a.name}),r&&i&&!d&&e.jsx(P,{className:"bg-red-500/20 text-red-500 border-red-500/30 animate-pulse",children:"LIVE"}),d&&e.jsx(P,{className:"bg-gray-500/20 text-gray-500 border-gray-500/30",children:"ENDED"}),!i&&e.jsx(P,{className:"bg-blue-500/20 text-blue-500 border-blue-500/30",children:"SCHEDULED"})]}),a.description&&e.jsx("p",{className:"text-gray-400 mb-4",children:a.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Discount"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4 text-red-500"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[a.discountPercentage,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Price"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500 line-through",children:["$",a.originalPrice]}),e.jsxs("span",{className:"text-lg font-bold text-green-500",children:["$",a.salePrice]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Period"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-4 h-4 text-primary"}),e.jsxs("p",{className:"text-sm text-white",children:[new Date(a.startTime).toLocaleDateString()," -"," ",new Date(a.endTime).toLocaleDateString()]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Stock"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4 text-amber-500"}),e.jsx("p",{className:"text-sm text-white",children:a.maxPurchases?`${a.maxPurchases-a.currentPurchases}/${a.maxPurchases}`:"Unlimited"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>V(a),className:"border-gray-700 text-gray-300",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{confirm("Are you sure you want to delete this flash sale?")&&z.mutate(a.id)},className:"border-gray-700 text-red-500 hover:bg-red-500/10",children:e.jsx(ie,{className:"w-4 h-4"})})]})]})})},a.id)})})]}),e.jsx(q,{open:H,onOpenChange:m,children:e.jsxs(L,{className:"bg-gray-900 border-gray-800 text-white w-[95vw] max-w-2xl",children:[e.jsxs(O,{children:[e.jsx(U,{children:"Create Flash Sale"}),e.jsx($,{className:"text-gray-400",children:"Set up a limited-time offer for a currency package"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Sale Name (optional)"}),e.jsx(l,{value:s.name,onChange:a=>t({...s,name:a.target.value}),placeholder:"e.g., Weekend Special",className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Description (optional)"}),e.jsx(A,{value:s.description,onChange:a=>t({...s,description:a.target.value}),placeholder:"Brief description of the sale",className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Select Package *"}),e.jsxs(ne,{value:s.targetId,onValueChange:a=>t({...s,targetId:a}),children:[e.jsx(ce,{className:"bg-gray-800 border-gray-700 text-white",children:e.jsx(le,{placeholder:"Choose a currency package"})}),e.jsx(de,{className:"bg-gray-800 border-gray-700",children:x?.map(a=>e.jsxs(oe,{value:a.id,className:"text-white",children:[a.name," - ",a.currencyAmount," coins ($",a.priceUSD,")"]},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Discount Percentage *"}),e.jsx(l,{type:"number",value:s.discountPercentage,onChange:a=>t({...s,discountPercentage:a.target.value}),placeholder:"20",min:"1",max:"90",className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Start Time *"}),e.jsx(l,{type:"datetime-local",value:s.startTime,onChange:a=>t({...s,startTime:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"End Time *"}),e.jsx(l,{type:"datetime-local",value:s.endTime,onChange:a=>t({...s,endTime:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Max Purchases (optional)"}),e.jsx(l,{type:"number",value:s.maxPurchases,onChange:a=>t({...s,maxPurchases:a.target.value}),placeholder:"Leave empty for unlimited",min:"1",className:"bg-gray-800 border-gray-700 text-white"})]}),s.targetId&&s.discountPercentage&&e.jsx("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-gray-300",children:["Sale Price: $",(parseFloat(x?.find(a=>a.id===s.targetId)?.priceUSD||"0")*(1-parseFloat(s.discountPercentage)/100)).toFixed(2)]})})]}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>m(!1),className:"border-gray-700",children:"Cancel"}),e.jsx(c,{onClick:R,disabled:b.isPending,className:"bg-gradient-to-r from-red-500 to-orange-500",children:b.isPending?"Creating...":"Create Flash Sale"})]})]})}),e.jsx(q,{open:K,onOpenChange:h,children:e.jsxs(L,{className:"bg-gray-900 border-gray-800 text-white w-[95vw] max-w-2xl",children:[e.jsxs(O,{children:[e.jsx(U,{children:"Edit Flash Sale"}),e.jsx($,{className:"text-gray-400",children:"Update flash sale details"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Sale Name"}),e.jsx(l,{value:s.name,onChange:a=>t({...s,name:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Description"}),e.jsx(A,{value:s.description,onChange:a=>t({...s,description:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Discount Percentage"}),e.jsx(l,{type:"number",value:s.discountPercentage,onChange:a=>t({...s,discountPercentage:a.target.value}),min:"1",max:"90",className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Start Time"}),e.jsx(l,{type:"datetime-local",value:s.startTime,onChange:a=>t({...s,startTime:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"End Time"}),e.jsx(l,{type:"datetime-local",value:s.endTime,onChange:a=>t({...s,endTime:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Max Purchases"}),e.jsx(l,{type:"number",value:s.maxPurchases,onChange:a=>t({...s,maxPurchases:a.target.value}),placeholder:"Leave empty for unlimited",min:"1",className:"bg-gray-800 border-gray-700 text-white"})]})]}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>h(!1),className:"border-gray-700",children:"Cancel"}),e.jsx(c,{onClick:J,disabled:f.isPending,className:"bg-primary",children:f.isPending?"Updating...":"Update Flash Sale"})]})]})})]})}export{we as default};
