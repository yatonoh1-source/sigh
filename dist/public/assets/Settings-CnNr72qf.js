import{j as e}from"./ui-vendor-_s0klCrL.js";import{u as V,b as p}from"./react-vendor-C7VPsBAG.js";import{c as q,u as W,z as Z,a as X,b as D,d as A,t as n,q as N,f as E,e as _,L as v,S as ee,B as d,A as se,g as ae,C as x,h as g,i as f,U as re,j as b,k as j,l as te,m as ie,n as ne,o as le,p as oe,r as c,I as h,M as ce,s as de,v as ue,w as me,x as he,y as l,D as pe,E as xe,F as ge,G as fe}from"./index-BLJ_ytcB.js";import{D as je,a as ye,b as we,c as Ne,d as ve,e as be}from"./dialog-BPAt-TF-.js";import{M as Pe}from"./map-pin-DBn9lb12.js";import{T as U}from"./trophy-C_Kv6fHf.js";import{M as O}from"./monitor-C8b6Kadu.js";import"./utils-vendor-DYGWDIxX.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=q("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=q("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);function Oe(){const{isAuthenticated:u,isLoading:P}=W(),[,k]=V(),{theme:I,setTheme:T}=Z(),{logout:K,isLoggingOut:L}=X(),[r,t]=p.useState({username:"",email:"",firstName:"",lastName:"",country:"",profilePicture:null}),[z,y]=p.useState(!1),[m,w]=p.useState({oldPassword:"",newPassword:""}),{data:C,isLoading:B}=D({queryKey:["/api/achievements"],queryFn:async()=>{const s=await fetch("/api/achievements",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch achievements");return s.json()},enabled:u}),{data:Q,isLoading:J}=D({queryKey:["/api/achievements/my-progress"],queryFn:async()=>{const s=await fetch("/api/achievements/my-progress",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch user achievements");return s.json()},enabled:u});p.useEffect(()=>{!P&&!u&&k("/login?returnTo=/settings")},[P,u,k]);const{data:o,isLoading:R}=D({queryKey:["/api/user/profile"],queryFn:async()=>{const s=await fetch("/api/user/profile",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch profile");return(await s.json()).user},enabled:u,retry:!1});p.useEffect(()=>{o&&t({username:o.username||"",email:o.email||"",firstName:o.firstName||"",lastName:o.lastName||"",country:o.country||"",profilePicture:o.profilePicture||null})},[o]);const F=A({mutationFn:async s=>{const a=await E("/api/user/profile",{method:"PUT",body:JSON.stringify(s)});if(!a.ok){const i=await a.json();throw new Error(i.message||"Failed to update profile")}return a.json()},onSuccess:s=>{N.invalidateQueries({queryKey:["/api/user/profile"]}),N.invalidateQueries({queryKey:["/api/auth/user"]}),n({title:"Profile Updated",description:"Your profile has been updated successfully.",variant:"success"}),s.user&&t(a=>({...a,username:s.user.username||a.username,email:s.user.email||a.email,firstName:s.user.firstName||a.firstName,lastName:s.user.lastName||a.lastName,country:s.user.country||a.country}))},onError:s=>{n({title:"Update Failed",description:s.message,variant:"error"})}}),S=A({mutationFn:async s=>{const a=new FormData;a.append("profilePicture",s);const i=await _("/api/user/profile-picture",a);if(!i.ok){const H=await i.json();throw new Error(H.message||"Failed to upload profile picture")}return i.json()},onSuccess:s=>{N.invalidateQueries({queryKey:["/api/user/profile"]}),N.invalidateQueries({queryKey:["/api/auth/user"]}),t(a=>({...a,profilePicture:s.profilePicture})),n({title:"Profile Picture Updated",description:"Your profile picture has been uploaded successfully.",variant:"success"})},onError:s=>{n({title:"Upload Failed",description:s.message,variant:"error"})}}),M=A({mutationFn:async s=>{const a=await E("/api/user/password",{method:"PUT",body:JSON.stringify(s)});if(!a.ok){const i=await a.json();throw new Error(i.message||"Failed to change password")}return a.json()},onSuccess:()=>{n({title:"Password Changed",description:"Your password has been updated successfully.",variant:"success"}),w({oldPassword:"",newPassword:""}),y(!1)},onError:s=>{n({title:"Password Change Failed",description:s.message,variant:"error"})}}),Y=s=>{const a=s.target.files?.[0];if(a){if(a.size>5*1024*1024){n({title:"File Too Large",description:"Profile picture must be less than 5MB.",variant:"error"});return}S.mutate(a)}},$=()=>{F.mutate({username:r.username,email:r.email,firstName:r.firstName,lastName:r.lastName,country:r.country})},G=()=>{if(!m.oldPassword||!m.newPassword){n({title:"Missing Fields",description:"Please fill in both password fields.",variant:"error"});return}if(m.newPassword.length<8){n({title:"Invalid Password",description:"New password must be at least 8 characters long.",variant:"error"});return}M.mutate(m)};return P||R?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-4 flex items-center justify-center",children:e.jsx(v,{className:"w-8 h-8 animate-spin text-primary"})}):u?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-4",children:[e.jsx(ee,{title:"Account Settings - Manage Your AmourScans Profile",description:"Manage your AmourScans profile, preferences, and account security settings. Update your password, profile picture, and customize your reading experience.",keywords:"account settings, profile settings, manga preferences, user settings, account security"}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(d,{variant:"ghost",onClick:()=>k("/"),className:"min-h-11 w-fit text-muted-foreground hover:text-primary mb-4",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"w-8 h-8 text-primary"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-primary via-accent to-purple-400 bg-clip-text text-transparent",children:"Settings"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(x,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile Information"})]}),e.jsx(b,{children:"Manage your profile details and preferences"})]}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(te,{className:"w-20 h-20",children:[e.jsx(ie,{src:r.profilePicture||void 0}),e.jsx(ne,{className:"text-2xl bg-primary/10 text-primary",children:r.username?.charAt(0)?.toUpperCase()||"U"})]}),e.jsxs("label",{htmlFor:"profile-upload",className:"absolute -bottom-2 -right-2 bg-primary hover:bg-primary/90 text-primary-foreground rounded-full p-2 cursor-pointer shadow-lg transition-colors",children:[S.isPending?e.jsx(v,{className:"w-4 h-4 animate-spin"}):e.jsx(le,{className:"w-4 h-4"}),e.jsx("input",{id:"profile-upload",type:"file",accept:"image/*",autoComplete:"off",onChange:Y,className:"hidden",disabled:S.isPending})]})]}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a profile picture. Max size: 5MB. Recommended: 400x400px"})})]}),e.jsx(oe,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"username",children:"Username"}),e.jsx(h,{id:"username",value:r.username,onChange:s=>t(a=>({...a,username:s.target.value})),className:"h-12 bg-background/50",autoComplete:"username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{id:"email",type:"email",value:r.email,onChange:s=>t(a=>({...a,email:s.target.value})),className:"h-12 bg-background/50 pl-10",autoComplete:"email"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"firstName",children:"First Name (Optional)"}),e.jsx(h,{id:"firstName",value:r.firstName,onChange:s=>t(a=>({...a,firstName:s.target.value})),className:"h-12 bg-background/50",placeholder:"John",autoComplete:"given-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"lastName",children:"Last Name (Optional)"}),e.jsx(h,{id:"lastName",value:r.lastName,onChange:s=>t(a=>({...a,lastName:s.target.value})),className:"h-12 bg-background/50",placeholder:"Doe",autoComplete:"family-name"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(c,{htmlFor:"country",children:"Country (Optional)"}),e.jsx("input",{type:"text",name:"country",autoComplete:"country-name",value:r.country||"",tabIndex:-1,"aria-hidden":"true",className:"absolute -left-[9999px] w-1 h-1 opacity-0",onChange:s=>{t({...r,country:s.target.value})}}),e.jsxs(de,{value:r.country,onValueChange:s=>t(a=>({...a,country:s})),children:[e.jsx(ue,{className:"h-12 bg-background/50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(me,{placeholder:"Select your country"})]})}),e.jsxs(he,{children:[e.jsx(l,{value:"us",children:"United States"}),e.jsx(l,{value:"ca",children:"Canada"}),e.jsx(l,{value:"uk",children:"United Kingdom"}),e.jsx(l,{value:"jp",children:"Japan"}),e.jsx(l,{value:"kr",children:"South Korea"}),e.jsx(l,{value:"fr",children:"France"}),e.jsx(l,{value:"de",children:"Germany"}),e.jsx(l,{value:"au",children:"Australia"}),e.jsx(l,{value:"other",children:"Other"})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(d,{className:"min-h-11 bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90 text-white",onClick:$,disabled:F.isPending,children:F.isPending?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):"Save Profile"})})]})]}),e.jsxs(x,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(g,{children:[e.jsx(f,{children:"Account Security"}),e.jsx(b,{children:"Manage your password and account security"})]}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Change Password"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your password for security"})]}),e.jsxs(d,{variant:"outline",className:"min-h-11",onClick:()=>y(!0),children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Update Password"]})]})})]}),e.jsxs(x,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:"Achievements"})]}),e.jsx(b,{children:"Track your reading milestones and accomplishments"})]}),e.jsx(j,{children:B||J?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"h-20 bg-background/50 animate-pulse rounded-lg"},s))}):C&&C.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:C.map(s=>{const a=Q?.some(i=>i.achievementId===s.id);return e.jsx("div",{className:`p-3 rounded-lg border transition-all ${a?"bg-primary/10 border-primary/50 hover:bg-primary/20":"bg-background/30 border-border/30 opacity-50 grayscale"}`,children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[s.badgeIcon?e.jsx("span",{className:"text-2xl",children:s.badgeIcon}):e.jsx(xe,{className:`w-8 h-8 ${a?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-semibold ${a?"text-foreground":"text-muted-foreground"}`,children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s.description}),a&&s.coinReward>0&&e.jsxs(ge,{variant:"secondary",className:"mt-1 text-xs",children:["+",s.coinReward," coins"]})]})]})},s.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No achievements available yet"})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{children:"Appearance"})]}),e.jsx(b,{children:"Customize how AmourScans looks and feels"})]}),e.jsx(j,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{children:"Theme Preference"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:[{value:"light",label:"Light",icon:Ce},{value:"dark",label:"Dark",icon:ke},{value:"system",label:"System",icon:O}].map(s=>{const a=s.icon;return e.jsxs(d,{variant:I===s.value?"default":"outline",className:"justify-start",onClick:()=>T(s.value),children:[e.jsx(a,{className:"w-4 h-4 mr-2"}),s.label]},s.value)})})]})})]}),e.jsxs(x,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsx(g,{children:e.jsx(f,{children:"Quick Actions"})}),e.jsx(j,{className:"space-y-2",children:e.jsxs(d,{variant:"outline",className:"w-full justify-start text-destructive hover:text-destructive",onClick:()=>K(),disabled:L,"data-testid":"settings-logout-button",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),L?"Signing out...":"Sign Out"]})})]})]})]})]}),e.jsx(je,{open:z,onOpenChange:y,children:e.jsxs(ye,{className:"sm:max-w-[425px]",children:[e.jsxs(we,{children:[e.jsx(Ne,{children:"Change Password"}),e.jsx(ve,{children:"Enter your current password and a new password to update your account security."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"current-password",children:"Current Password"}),e.jsx(h,{id:"current-password",type:"password",value:m.oldPassword,onChange:s=>w(a=>({...a,oldPassword:s.target.value})),placeholder:"Enter current password",autoComplete:"current-password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"new-password",children:"New Password"}),e.jsx(h,{id:"new-password",type:"password",value:m.newPassword,onChange:s=>w(a=>({...a,newPassword:s.target.value})),placeholder:"Enter new password (min 8 characters)",autoComplete:"new-password"})]})]}),e.jsxs(be,{children:[e.jsx(d,{variant:"outline",onClick:()=>{y(!1),w({oldPassword:"",newPassword:""})},children:"Cancel"}),e.jsx(d,{onClick:G,disabled:M.isPending,children:M.isPending?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2 animate-spin"}),"Changing..."]}):"Change Password"})]})]})})]}):null}export{Oe as default};
