import{j as e}from"./ui-vendor-_s0klCrL.js";import{u as we,b as r}from"./react-vendor-C7VPsBAG.js";import{u as be,ax as Ce,b as z,d as j,t,f as v,C as G,h as Y,i as Z,j as _,k as ee,B as i,L as x,A as Ne,a1 as L,ak as ke,F as Se,a0 as Re,r as o,I as c,aq as Ee,av as Ae,s as se,v as ae,w as ie,x as ne,y as re}from"./index-BLJ_ytcB.js";import{D as y,a as f,b as w,c as b,d as C,e as N}from"./dialog-BPAt-TF-.js";import{C as Pe}from"./crown-Cq9T_P0l.js";import{P as De}from"./plus-k2bBbm5g.js";import{S as Fe}from"./square-pen-CRfgceVq.js";import"./utils-vendor-DYGWDIxX.js";const Me=[{name:"User Management",permissions:[{key:"manageUsers",label:"Manage Users",description:"Create, edit, and delete users"},{key:"viewUsers",label:"View Users",description:"View user list and details"},{key:"banUsers",label:"Ban Users",description:"Ban and unban users"},{key:"warnUsers",label:"Warn Users",description:"Issue warnings to users"},{key:"assignRoles",label:"Assign Roles",description:"Assign roles to users"}]},{name:"Content Management",permissions:[{key:"manageSeries",label:"Manage Series",description:"Create, edit, delete manga/manhwa"},{key:"manageChapters",label:"Manage Chapters",description:"Upload, edit, delete chapters"},{key:"moderateComments",label:"Moderate Comments",description:"Delete and moderate user comments"}]},{name:"Advertisement & Analytics",permissions:[{key:"manageAds",label:"Manage Ads",description:"Create, edit, delete advertisements"},{key:"viewAdAnalytics",label:"View Ad Analytics",description:"View ad performance metrics"},{key:"viewAnalytics",label:"View Analytics",description:"View analytics dashboard"},{key:"viewDetailedAnalytics",label:"View Detailed Analytics",description:"View detailed analytics reports"}]},{name:"System Configuration",permissions:[{key:"configureRoles",label:"Configure Roles",description:"Create, edit, delete roles & permissions"},{key:"manageSettings",label:"Manage Settings",description:"Change system settings"},{key:"viewLogs",label:"View Logs",description:"View admin activity logs"}]},{name:"Business Operations",permissions:[{key:"handleDmca",label:"Handle DMCA",description:"Manage DMCA notices"},{key:"manageSubscriptions",label:"Manage Subscriptions",description:"Manage subscription plans"},{key:"manageCurrency",label:"Manage Currency",description:"Adjust user currency balances"}]}];async function Oe(){const n=await fetch("/api/roles",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error("Failed to fetch roles");return n.json()}async function Le(){const n=await fetch("/api/admin/users",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error("Failed to fetch users");return n.json()}function Qe(){const{isAuthenticated:n,isOwner:U}=be(),[,$]=we(),p=Ce(),[te,k]=r.useState(!1),[le,S]=r.useState(!1),[oe,R]=r.useState(!1),[ce,E]=r.useState(!1),[de,A]=r.useState(!1),[l,m]=r.useState(null),[q,J]=r.useState(""),[g,P]=r.useState(""),[D,F]=r.useState(""),[M,O]=r.useState(10),[h,u]=r.useState("#6366f1"),[W,I]=r.useState({}),{data:V,isLoading:me}=z({queryKey:["roles"],queryFn:Oe,enabled:U&&n}),{data:he}=z({queryKey:["admin-users"],queryFn:Le,enabled:U&&n}),H=j({mutationFn:async s=>{const a=await v("/api/roles",{method:"POST",body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to create role");return a.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["roles"]}),t({title:"Success",description:"Role created successfully!",variant:"success"}),k(!1),X()},onError:s=>{t({title:"Error",description:s.message,variant:"error"})}}),T=j({mutationFn:async({id:s,data:a})=>{const d=await v(`/api/roles/${s}`,{method:"PUT",body:JSON.stringify(a)});if(!d.ok)throw new Error("Failed to update role");return d.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["roles"]}),t({title:"Success",description:"Role updated successfully!",variant:"success"}),S(!1),X()},onError:s=>{t({title:"Error",description:s.message,variant:"error"})}}),B=j({mutationFn:async s=>{const a=await v(`/api/roles/${s}`,{method:"DELETE"});if(!a.ok)throw new Error("Failed to delete role");return a.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["roles"]}),t({title:"Success",description:"Role deleted successfully!",variant:"success"}),R(!1),m(null)},onError:s=>{t({title:"Error",description:s.message,variant:"error"})}}),K=j({mutationFn:async({roleId:s,permissions:a})=>{const d=await v(`/api/roles/${s}/permissions`,{method:"PUT",body:JSON.stringify(a)});if(!d.ok)throw new Error("Failed to update permissions");return d.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["roles"]}),t({title:"Success",description:"Permissions updated successfully!",variant:"success"}),E(!1),m(null)},onError:s=>{t({title:"Error",description:s.message,variant:"error"})}}),Q=j({mutationFn:async({userId:s,roleName:a})=>{const d=await v(`/api/users/${s}/role`,{method:"PUT",body:JSON.stringify({roleName:a})});if(!d.ok)throw new Error("Failed to assign role");return d.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["admin-users"]}),t({title:"Success",description:"Role assigned successfully!",variant:"success"}),A(!1),J(""),m(null)},onError:s=>{t({title:"Error",description:s.message,variant:"error"})}}),X=()=>{P(""),F(""),O(10),u("#6366f1"),I({})},ue=()=>{if(!g.trim()){t({title:"Error",description:"Role name is required",variant:"error"});return}H.mutate({name:g,description:D||null,hierarchyLevel:M,color:h,isSystem:"false"})},xe=()=>{l&&T.mutate({id:l.id,data:{name:g,description:D||null,hierarchyLevel:M,color:h}})},pe=()=>{l&&B.mutate(l.id)},ge=()=>{l&&K.mutate({roleId:l.id,permissions:W})},je=()=>{if(!q||!l){t({title:"Error",description:"Please select a user and role",variant:"error"});return}Q.mutate({userId:q,roleName:l.name})},ve=s=>{m(s),P(s.name),F(s.description||""),O(s.hierarchyLevel),u(s.color||"#6366f1"),S(!0)},ye=s=>{m(s),I(s.permissions),E(!0)},fe=s=>{I(a=>({...a,[s]:a[s]==="true"?"false":"true"}))};return!n||!U?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 flex items-center justify-center p-4",children:e.jsxs(G,{className:"max-w-md w-full bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(Y,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center",children:e.jsx(Pe,{className:"w-8 h-8 text-destructive"})}),e.jsx(Z,{className:"text-2xl",children:"Owner Access Required"}),e.jsx(_,{className:"mt-2",children:n?"Only the owner can manage roles and permissions.":"Please log in with an owner account to access role management."})]}),e.jsx(ee,{className:"flex flex-col gap-3",children:e.jsx(i,{onClick:()=>$(n?"/":"/login"),className:"w-full",children:n?"Return to Home":"Go to Login"})})]})}):me?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 flex items-center justify-center",children:e.jsx(x,{className:"w-12 h-12 animate-spin text-primary"})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-2 sm:p-4",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[e.jsxs(i,{variant:"ghost",onClick:()=>$("/admin"),className:"w-full sm:w-fit text-muted-foreground hover:text-primary mb-4 min-h-11 justify-start",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Role Authority Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure roles and permissions for your platform"})]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsxs(i,{onClick:()=>k(!0),className:"gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Create Role"]}),e.jsxs(i,{onClick:()=>A(!0),variant:"outline",className:"gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),"Assign Roles to Users"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:V?.map(s=>e.jsxs(G,{className:"bg-card/50 backdrop-blur-sm border-border/50 hover:shadow-lg transition-shadow",children:[e.jsxs(Y,{children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:`${s.color||"#6366f1"}20`,color:s.color||"#6366f1"},children:e.jsx(L,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs(Z,{className:"text-xl flex items-center gap-2",children:[s.name,s.isSystem==="true"&&e.jsxs(Se,{variant:"secondary",className:"text-xs flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),"Protected"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Level ",s.hierarchyLevel]})]})]})}),e.jsx(_,{className:"mt-3",children:s.description||"No description"})]}),e.jsxs(ee,{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>ve(s),disabled:s.isSystem==="true",className:"flex-1 gap-2",title:s.isSystem==="true"?"System roles cannot be renamed or deleted (but permissions can be edited)":"Edit role name and details",children:[e.jsx(Fe,{className:"w-3 h-3"}),s.isSystem==="true"?"Locked":"Edit"]}),e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>{m(s),R(!0)},disabled:s.isSystem==="true",className:"flex-1 gap-2 text-destructive hover:text-destructive",title:s.isSystem==="true"?"System roles are protected and cannot be deleted":"Delete this role",children:[e.jsx(Re,{className:"w-3 h-3"}),"Delete"]})]}),e.jsxs(i,{size:"sm",onClick:()=>ye(s),className:"w-full gap-2",variant:"default",children:[e.jsx(L,{className:"w-3 h-3"}),"Manage Permissions"]})]})]},s.id))}),e.jsx(y,{open:te,onOpenChange:k,children:e.jsxs(f,{className:"w-[95vw] max-w-lg",children:[e.jsxs(w,{children:[e.jsx(b,{children:"Create New Role"}),e.jsx(C,{children:"Define a new role with custom hierarchy level and appearance."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"name",children:"Role Name *"}),e.jsx(c,{id:"name",value:g,onChange:s=>P(s.target.value),placeholder:"e.g., Moderator"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"description",children:"Description"}),e.jsx(c,{id:"description",value:D,onChange:s=>F(s.target.value),placeholder:"Role description..."})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"hierarchy",children:"Hierarchy Level (0-100)"}),e.jsx(c,{id:"hierarchy",type:"number",min:"0",max:"100",value:M,onChange:s=>O(parseInt(s.target.value)||0)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Higher = more authority"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"color",children:"Role Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{id:"color",type:"color",value:h,onChange:s=>u(s.target.value),className:"w-20"}),e.jsx(c,{value:h,onChange:s=>u(s.target.value),placeholder:"#6366f1"})]})]})]}),e.jsxs(N,{children:[e.jsx(i,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(i,{onClick:ue,disabled:H.isPending,children:H.isPending?e.jsx(x,{className:"w-4 h-4 animate-spin"}):"Create Role"})]})]})}),e.jsx(y,{open:le,onOpenChange:S,children:e.jsxs(f,{className:"w-[95vw] max-w-lg",children:[e.jsxs(w,{children:[e.jsx(b,{children:"Edit Role"}),e.jsx(C,{children:"Update role information and hierarchy."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit-name",children:"Role Name *"}),e.jsx(c,{id:"edit-name",value:g,onChange:s=>P(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit-description",children:"Description"}),e.jsx(c,{id:"edit-description",value:D,onChange:s=>F(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit-hierarchy",children:"Hierarchy Level (0-100)"}),e.jsx(c,{id:"edit-hierarchy",type:"number",min:"0",max:"100",value:M,onChange:s=>O(parseInt(s.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit-color",children:"Role Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{id:"edit-color",type:"color",value:h,onChange:s=>u(s.target.value),className:"w-20"}),e.jsx(c,{value:h,onChange:s=>u(s.target.value)})]})]})]}),e.jsxs(N,{children:[e.jsx(i,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(i,{onClick:xe,disabled:T.isPending,children:T.isPending?e.jsx(x,{className:"w-4 h-4 animate-spin"}):"Save Changes"})]})]})}),e.jsx(y,{open:oe,onOpenChange:R,children:e.jsxs(f,{className:"w-[95vw] max-w-lg",children:[e.jsxs(w,{children:[e.jsx(b,{children:"Delete Role"}),e.jsxs(C,{children:['Are you sure you want to delete the role "',l?.name,'"? This action cannot be undone.']})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-destructive/10 rounded-lg border border-destructive/20",children:[e.jsx(Ee,{className:"w-5 h-5 text-destructive"}),e.jsx("p",{className:"text-sm",children:"System roles cannot be deleted, and roles assigned to users cannot be removed."})]}),e.jsxs(N,{children:[e.jsx(i,{variant:"outline",onClick:()=>R(!1),children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:pe,disabled:B.isPending,children:B.isPending?e.jsx(x,{className:"w-4 h-4 animate-spin"}):"Delete Role"})]})]})}),e.jsx(y,{open:ce,onOpenChange:E,children:e.jsxs(f,{className:"w-[95vw] max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(w,{children:[e.jsxs(b,{children:["Manage Permissions: ",l?.name]}),e.jsx(C,{children:"Configure what this role can do within the platform."})]}),e.jsx("div",{className:"space-y-6",children:Me.map(s=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:s.name}),e.jsx("div",{className:"space-y-3 pl-4",children:s.permissions.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:a.label}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.description})]}),e.jsx(Ae,{checked:W[a.key]==="true",onCheckedChange:()=>fe(a.key)})]},a.key))})]},s.name))}),e.jsxs(N,{children:[e.jsx(i,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),e.jsx(i,{onClick:ge,disabled:K.isPending,children:K.isPending?e.jsx(x,{className:"w-4 h-4 animate-spin"}):"Save Permissions"})]})]})}),e.jsx(y,{open:de,onOpenChange:A,children:e.jsxs(f,{className:"w-[95vw] max-w-lg",children:[e.jsxs(w,{children:[e.jsx(b,{children:"Assign Role to User"}),e.jsx(C,{children:"Select a user and assign them a role."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"user-select",children:"Select User"}),e.jsxs(se,{value:q,onValueChange:J,children:[e.jsx(ae,{children:e.jsx(ie,{placeholder:"Choose a user..."})}),e.jsx(ne,{children:he?.map(s=>e.jsxs(re,{value:s.id,children:[s.username," (",s.email,") - Current: ",s.role]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"role-select",children:"Select Role"}),e.jsxs(se,{value:l?.id||"",onValueChange:s=>m(V?.find(a=>a.id===s)||null),children:[e.jsx(ae,{children:e.jsx(ie,{placeholder:"Choose a role..."})}),e.jsx(ne,{children:V?.map(s=>e.jsxs(re,{value:s.id,children:[s.name," (Level ",s.hierarchyLevel,")"]},s.id))})]})]})]}),e.jsxs(N,{children:[e.jsx(i,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsx(i,{onClick:je,disabled:Q.isPending,children:Q.isPending?e.jsx(x,{className:"w-4 h-4 animate-spin"}):"Assign Role"})]})]})})]})})}export{Qe as default};
