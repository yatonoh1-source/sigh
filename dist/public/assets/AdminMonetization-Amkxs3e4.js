import{j as e}from"./ui-vendor-_s0klCrL.js";import{b as c,u as ka}from"./react-vendor-C7VPsBAG.js";import{c as Aa,_ as Cs,ax as ks,b as U,at as ss,D as Da,C as m,h as j,i as g,j as k,k as x,L as fs,az as H,r,av as Pa,s as I,v as O,w as M,x as q,y as d,B as t,f as C,u as Fa,d as P,ae as ys,A as Ea,a9 as Ne,aa as Je,ab as He,ac as L,ad as B,p as Ge,F as E,a0 as we,I as u,ak as Ye,aE as Ua,a3 as Ta,aw as bs,an as La,am as Ba,$ as Ns,al as Ia,g as Oa,aF as Ze,aG as We,a5 as W,aH as Ma,aI as qa,aJ as Ra,aK as $a,aL as Ka,aM as Va}from"./index-BLJ_ytcB.js";import{D as ce,a as le,b as de,c as oe,d as ue,e as me}from"./dialog-BPAt-TF-.js";import{T as za,a as _a,b as Fe,c as Se,d as Qa,e as X}from"./table-DVHEST2Z.js";import{L as Ja,B as Ha,C as Ga,a as Ya,b as Za,c as Wa,d as Xa,e as er,A as sr,p as ar,f as rr,g as nr,i as tr}from"./chart-vendor-BWHaG5wj.js";import{S as ir}from"./ShopControl-BYDEny0B.js";import{W as cr}from"./wrench-D2GTUzw_.js";import{S as As}from"./shield-off-j9I-w8cD.js";import{T as lr}from"./trophy-C_Kv6fHf.js";import{D as Ee}from"./dollar-sign-xVsTkna1.js";import{C as dr}from"./crown-Cq9T_P0l.js";import{Z as or}from"./zap-JsjwqhbD.js";import{P as ur}from"./package-DcYjros-.js";import{G as mr}from"./gift-lTXnbkoc.js";import{P as G}from"./plus-k2bBbm5g.js";import{S as Xe}from"./square-pen-CRfgceVq.js";import{D as ws}from"./download-BAdLORKC.js";import{F as xr}from"./file-text-BFdtmCm2.js";import{C as hr}from"./circle-check-big-B1R9t0pA.js";import{A as pr}from"./activity-Blw82mLV.js";import{M as es}from"./minus-IziBK7bE.js";import"./utils-vendor-DYGWDIxX.js";import"./shopping-cart-CoPQWzz9.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=Aa("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Ss=[{value:"enabled",label:"Enabled",description:"Battle Pass is fully operational",icon:ss,color:"text-green-600 dark:text-green-400"},{value:"maintenance",label:"Maintenance",description:"Battle Pass is under maintenance - show maintenance message",icon:cr,color:"text-orange-600 dark:text-orange-400"},{value:"coming_soon",label:"Coming Soon",description:"Battle Pass feature not yet available - show coming soon message",icon:Da,color:"text-blue-600 dark:text-blue-400"},{value:"disabled",label:"Disabled",description:"Battle Pass is completely disabled and hidden",icon:As,color:"text-red-600 dark:text-red-400"}];function gr(){const{toast:l}=Cs(),N=ks(),{data:y,isLoading:n}=U({queryKey:["admin-settings","system","battle_pass_enabled"],queryFn:async()=>{const p=await fetch("/api/admin/settings/system/battle_pass_enabled");if(!p.ok)return!0;const J=await p.json();return J.value==="true"||J.value===!0}}),{data:h,isLoading:Y}=U({queryKey:["admin-settings","system","battle_pass_mode"],queryFn:async()=>{const p=await fetch("/api/admin/settings/system/battle_pass_mode");return p.ok&&(await p.json()).value||"enabled"}}),[A,xe]=c.useState(y??!0),[R,D]=c.useState(h||"enabled"),[$,w]=c.useState(!1);c.useEffect(()=>{y!==void 0&&xe(y)},[y]),c.useEffect(()=>{h!==void 0&&D(h)},[h]);const he=async()=>{w(!0);try{if(!(await C("/api/admin/settings/system/battle_pass_enabled",{method:"PUT",body:JSON.stringify({category:"system",key:"battle_pass_enabled",value:A.toString(),type:"boolean",description:"Controls whether the Battle Pass feature is enabled",isPublic:!0})})).ok)throw new Error("Failed to save battle pass enabled status");if(!(await C("/api/admin/settings/system/battle_pass_mode",{method:"PUT",body:JSON.stringify({category:"system",key:"battle_pass_mode",value:R,type:"string",description:"Battle Pass display mode (enabled, maintenance, coming_soon, disabled)",isPublic:!0})})).ok)throw new Error("Failed to save battle pass mode");await N.invalidateQueries({queryKey:["admin-settings"]}),await N.invalidateQueries({queryKey:["/api/settings/public/battle-pass-status"]}),l({title:"Battle Pass Settings Saved",description:`Battle Pass is now ${A?`enabled (${R})`:"disabled"}`})}catch(p){l({title:"Error",description:p instanceof Error?p.message:"Failed to save battle pass settings",variant:"error"})}finally{w(!1)}},pe=A!==y||R!==h,ee=n||Y,S=Ss.find(p=>p.value===R),Q=S?.icon||ss;return e.jsxs(m,{className:"border-2 border-purple-500/20 shadow-lg",children:[e.jsx(j,{className:"space-y-1 pb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-purple-500/20 to-pink-500/20",children:e.jsx(lr,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx(g,{className:"text-2xl",children:"Battle Pass Control"}),e.jsx(k,{className:"text-base mt-1",children:"Configure Battle Pass feature availability and display mode"})]})]})}),e.jsx(x,{className:"space-y-8",children:ee?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(fs,{className:"h-8 w-8 animate-spin text-purple-500"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:H("relative overflow-hidden rounded-xl border-2 p-6 transition-all duration-300",A?"border-green-500/50 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/30 dark:to-emerald-950/30":"border-red-500/30 bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-950/20 dark:to-orange-950/20"),children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:H("p-3 rounded-full transition-colors",A?"bg-green-500/20":"bg-red-500/20"),children:A?e.jsx(ss,{className:"h-6 w-6 text-green-600 dark:text-green-400"}):e.jsx(As,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(r,{htmlFor:"battle-pass-toggle",className:"text-lg font-bold cursor-pointer",children:"Battle Pass Feature Status"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 max-w-md",children:A?"ðŸŸ¢ Enabled - Battle Pass feature is accessible to users":"ðŸ”´ Disabled - Battle Pass feature is completely hidden"})]})]}),e.jsx(Pa,{id:"battle-pass-toggle",checked:A,onCheckedChange:xe,className:"data-[state=checked]:bg-green-500"})]})}),e.jsxs("div",{className:H("p-4 rounded-lg border-2 transition-colors",A?"border-purple-200 dark:border-purple-800 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-950/30 dark:to-pink-950/30":"border-gray-200 dark:border-gray-700 bg-gray-100 dark:bg-gray-800/50"),children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Current Mode"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:H("h-8 w-8",A?S?.color:"text-gray-400")}),e.jsxs("div",{children:[e.jsx("div",{className:H("text-2xl font-bold",A?S?.color:"text-gray-400"),children:S?.label}),e.jsx("div",{className:H("text-sm mt-1",A?"text-muted-foreground":"text-gray-400"),children:S?.description})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(r,{htmlFor:"mode-selector",className:"text-sm font-medium",children:"Select Display Mode"}),e.jsxs(I,{value:R,onValueChange:D,disabled:!A,children:[e.jsx(O,{id:"mode-selector",className:"h-12",children:e.jsx(M,{})}),e.jsx(q,{children:Ss.map(p=>{const J=p.icon;return e.jsx(d,{value:p.value,children:e.jsxs("div",{className:"flex items-center gap-3 py-1",children:[e.jsx(J,{className:H("h-5 w-5",p.color)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:p.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:p.description})]})]})},p.value)})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(t,{onClick:he,disabled:!pe||$,className:H("flex-1 h-12 text-base font-semibold",pe&&"bg-purple-600 hover:bg-purple-700"),size:"lg",children:$?e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Changes"}),pe&&e.jsx(t,{variant:"outline",onClick:()=>{xe(y??!0),D(h||"enabled")},disabled:$,className:"h-12 text-base",size:"lg",children:"Reset"})]})]})})]})}Ga.register(Ya,Za,Wa,Xa,er,sr,ar,rr,nr,tr);async function vr(){const l=await fetch("/api/admin/packages",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch packages");return l.json()}async function fr(){const l=await fetch("/api/admin/coupons",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch coupons");return l.json()}async function yr(){const l=await fetch("/api/admin/invoices",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch invoices");return l.json()}async function br(){const l=await fetch("/api/admin/manual-assignments",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch assignments");return l.json()}async function Nr(){const l=await fetch("/api/admin/offline-purchases",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch offline purchases");return l.json()}async function wr(){const l=await fetch("/api/admin/currency/transactions",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch transactions");return l.json()}async function Sr(){const l=await fetch("/api/admin/currency/stats",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch currency stats");return l.json()}async function Cr(){const l=await fetch("/api/admin/users-detailed",{credentials:"include"});if(!l.ok)throw new Error("Failed to fetch users");return l.json()}async function kr(l){const N=await fetch(`/api/admin/user-transactions/${l}`,{credentials:"include"});if(!N.ok)throw new Error("Failed to fetch user transactions");return N.json()}function Wr(){const[,l]=ka(),{isAdmin:N,isAuthenticated:y}=Fa(),{toast:n}=Cs(),h=ks(),[Y,A]=c.useState("30d"),[xe,R]=c.useState(!1),[D,$]=c.useState({code:"",type:"percentage",value:"",minPurchaseAmount:"",maxUses:"",expiresAt:"",isActive:"true"}),[w,he]=c.useState({status:"all",packageId:"",startDate:"",endDate:""}),[pe,ee]=c.useState(!1),[S,Q]=c.useState({userId:"",packageId:"",packageType:"currency",reason:"",expiresAt:""}),[p,J]=c.useState(""),[je,as]=c.useState(""),[rs,ns]=c.useState(""),[Ds,Ue]=c.useState(0),[Ps,se]=c.useState(!1),[ge,Te]=c.useState("add"),[ve,ts]=c.useState(""),[Le,is]=c.useState(""),[Ce,Fs]=c.useState(""),[ke,Es]=c.useState("all"),[Ae,Us]=c.useState("all"),[ae,Ts]=c.useState("username"),[Z,cs]=c.useState("asc"),[b,ls]=c.useState(null),[Ls,ds]=c.useState(!1),[Bs,re]=c.useState(!1),[fe,Be]=c.useState(null),[v,K]=c.useState({name:"",description:"",currencyAmount:"",priceUSD:"",bonusPercentage:"0",isActive:"true",displayOrder:"0"}),[Is,ne]=c.useState(!1),[ye,Ie]=c.useState(null),[i,F]=c.useState({name:"",description:"",priceUSD:"",billingCycle:"monthly",features:"",coinBonus:"0",discountPercentage:"0",isAdFree:"false",trialDays:"0",isActive:"true",displayOrder:"0",stripePriceId:""}),[Os,te]=c.useState(!1),[be,Oe]=c.useState(null),[f,V]=c.useState({name:"",description:"",bundleType:"currency",priceUSD:"",items:"",isActive:"true",displayOrder:"0"}),{data:T,isLoading:Ms}=U({queryKey:["/api/admin/monetization/stats",Y],queryFn:async()=>{const s=await fetch(`/api/admin/monetization/stats?range=${Y}`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch stats");return s.json()},enabled:N&&y}),{data:os,isLoading:qs}=U({queryKey:["/api/admin/monetization/top-packages"],queryFn:async()=>{const s=await fetch("/api/admin/monetization/top-packages",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch top packages");return s.json()},enabled:N&&y}),{data:us,isLoading:Rs}=U({queryKey:["/api/admin/monetization/revenue-history",Y],queryFn:async()=>{const s=await fetch(`/api/admin/monetization/revenue-history?range=${Y}`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch revenue history");return s.json()},enabled:N&&y}),{data:ie,isLoading:Me}=U({queryKey:["admin-packages"],queryFn:vr,enabled:N&&y}),{data:$s,isLoading:Ks}=U({queryKey:["admin-coupons"],queryFn:fr,enabled:N&&y}),{data:ms,isLoading:Vs}=U({queryKey:["admin-invoices"],queryFn:yr,enabled:N&&y}),{data:xs,isLoading:zs}=U({queryKey:["admin-assignments"],queryFn:br,enabled:N&&y}),{data:hs,isLoading:_s}=U({queryKey:["admin-offline-purchases"],queryFn:Nr,enabled:N&&y}),{data:De,isLoading:ps,refetch:js}=U({queryKey:["admin-currency-transactions"],queryFn:wr,enabled:N&&y}),{data:qe,isLoading:Re}=U({queryKey:["admin-currency-stats"],queryFn:Sr,enabled:N&&y}),{data:$e,isLoading:Qs,refetch:Js}=U({queryKey:["admin-detailed-users"],queryFn:Cr,enabled:N&&y}),{data:Ke,isLoading:Hs}=U({queryKey:["admin-user-transactions",b?.id],queryFn:()=>b?kr(b.id):Promise.resolve([]),enabled:N&&y&&!!b}),Gs=P({mutationFn:async s=>{const a=await C("/api/admin/coupons",{method:"POST",body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to create coupon");return a.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-coupons"]}),n({title:"Success",description:"Coupon created successfully",variant:"success"}),R(!1),oa()},onError:()=>{n({title:"Error",description:"Failed to create coupon",variant:"error"})}}),Ys=P({mutationFn:async s=>{if(!(await C(`/api/admin/coupons/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete coupon")},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-coupons"]}),n({title:"Success",description:"Coupon deleted successfully",variant:"success"})},onError:()=>{n({title:"Error",description:"Failed to delete coupon",variant:"error"})}}),Zs=P({mutationFn:async s=>{const a=await C(`/api/admin/invoices/${s}/pdf`,{method:"POST"});if(!a.ok)throw new Error("Failed to generate PDF");return a.json()},onSuccess:s=>{if(s.pdfPath){const a=document.createElement("a");a.href=s.pdfPath,a.download=s.pdfPath.split("/").pop()||"invoice.pdf",a.click()}n({title:"Success",description:"Invoice PDF downloaded successfully",variant:"success"})},onError:()=>{n({title:"Error",description:"Failed to generate PDF",variant:"error"})}}),Ws=P({mutationFn:async s=>{const a=await C("/api/admin/manual-assignments",{method:"POST",body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to create assignment");return a.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-assignments"]}),n({title:"Success",description:"Package assigned successfully",variant:"success"}),ee(!1),Q({userId:"",packageId:"",packageType:"currency",reason:"",expiresAt:""})},onError:()=>{n({title:"Error",description:"Failed to assign package",variant:"error"})}}),Xs=P({mutationFn:async s=>{if(!(await C(`/api/admin/manual-assignments/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to revoke assignment")},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-assignments"]}),n({title:"Success",description:"Assignment revoked successfully",variant:"success"})},onError:()=>{n({title:"Error",description:"Failed to revoke assignment",variant:"error"})}}),ea=P({mutationFn:async s=>{const a=await C(`/api/admin/purchases/${s}/reconcile`,{method:"POST",body:JSON.stringify({status:"completed"})});if(!a.ok)throw new Error("Failed to reconcile purchase");return a.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-offline-purchases"]}),n({title:"Success",description:"Purchase reconciled successfully",variant:"success"})},onError:()=>{n({title:"Error",description:"Failed to reconcile purchase",variant:"error"})}}),sa=P({mutationFn:async s=>{const a=await C("/api/currency/packages",{method:"POST",body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to create currency package");return a.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-packages"]}),n({title:"Success",description:"Currency package created successfully",variant:"success"}),re(!1),Ve()},onError:()=>{n({title:"Error",description:"Failed to create currency package",variant:"error"})}}),aa=P({mutationFn:async({id:s,data:a})=>{const o=await C(`/api/currency/packages/${s}`,{method:"PATCH",body:JSON.stringify(a)});if(!o.ok)throw new Error("Failed to update currency package");return o.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-packages"]}),n({title:"Success",description:"Currency package updated successfully",variant:"success"}),re(!1),Be(null),Ve()},onError:()=>{n({title:"Error",description:"Failed to update currency package",variant:"error"})}}),ra=P({mutationFn:async s=>{if(!(await C(`/api/currency/packages/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete currency package")},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-packages"]}),n({title:"Success",description:"Currency package deleted successfully",variant:"success"})},onError:()=>{n({title:"Error",description:"Failed to delete currency package",variant:"error"})}}),na=P({mutationFn:async s=>{const a=await C("/api/admin/subscriptions",{method:"POST",body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to create subscription");return a.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-packages"]}),n({title:"Success",description:"Subscription created successfully",variant:"success"}),ne(!1),ze()},onError:()=>{n({title:"Error",description:"Failed to create subscription",variant:"error"})}}),ta=P({mutationFn:async({id:s,data:a})=>{const o=await C(`/api/admin/subscriptions/${s}`,{method:"PUT",body:JSON.stringify(a)});if(!o.ok)throw new Error("Failed to update subscription");return o.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-packages"]}),n({title:"Success",description:"Subscription updated successfully",variant:"success"}),ne(!1),Ie(null),ze()},onError:()=>{n({title:"Error",description:"Failed to update subscription",variant:"error"})}}),ia=P({mutationFn:async s=>{if(!(await C(`/api/admin/subscriptions/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete subscription")},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-packages"]}),n({title:"Success",description:"Subscription deleted successfully",variant:"success"})},onError:()=>{n({title:"Error",description:"Failed to delete subscription",variant:"error"})}}),ca=P({mutationFn:async s=>{const a=await C("/api/admin/bundles",{method:"POST",body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to create bundle");return a.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-packages"]}),n({title:"Success",description:"Bundle created successfully",variant:"success"}),te(!1),_e()},onError:()=>{n({title:"Error",description:"Failed to create bundle",variant:"error"})}}),la=P({mutationFn:async({id:s,data:a})=>{const o=await C(`/api/admin/bundles/${s}`,{method:"PUT",body:JSON.stringify(a)});if(!o.ok)throw new Error("Failed to update bundle");return o.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-packages"]}),n({title:"Success",description:"Bundle updated successfully",variant:"success"}),te(!1),Oe(null),_e()},onError:()=>{n({title:"Error",description:"Failed to update bundle",variant:"error"})}}),da=P({mutationFn:async s=>{if(!(await C(`/api/admin/bundles/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete bundle")},onSuccess:()=>{h.invalidateQueries({queryKey:["admin-packages"]}),n({title:"Success",description:"Bundle deleted successfully",variant:"success"})},onError:()=>{n({title:"Error",description:"Failed to delete bundle",variant:"error"})}}),gs=c.useMemo(()=>{if(!$e)return[];let s=[...$e];if(Ce){const a=Ce.toLowerCase();s=s.filter(o=>o.username.toLowerCase().includes(a)||(o.email||"").toLowerCase().includes(a))}return ke!=="all"&&(s=s.filter(a=>a.role===ke)),Ae==="vip"?s=s.filter(a=>a.subscription!==null):Ae==="none"&&(s=s.filter(a=>a.subscription===null)),s.sort((a,o)=>{let z,_;switch(ae){case"username":z=a.username.toLowerCase(),_=o.username.toLowerCase();break;case"role":z=a.role,_=o.role;break;case"balance":z=a.currencyBalance,_=o.currencyBalance;break;default:return 0}return z<_?Z==="asc"?-1:1:z>_?Z==="asc"?1:-1:0}),s},[$e,Ce,ke,Ae,ae,Z]),oa=()=>{$({code:"",type:"percentage",value:"",minPurchaseAmount:"",maxUses:"",expiresAt:"",isActive:"true"})},Ve=()=>{K({name:"",description:"",currencyAmount:"",priceUSD:"",bonusPercentage:"0",isActive:"true",displayOrder:"0"})},ze=()=>{F({name:"",description:"",priceUSD:"",billingCycle:"monthly",features:"",coinBonus:"0",discountPercentage:"0",isAdFree:"false",trialDays:"0",isActive:"true",displayOrder:"0",stripePriceId:""})},_e=()=>{V({name:"",description:"",bundleType:"currency",priceUSD:"",items:"",isActive:"true",displayOrder:"0"})},ua=()=>{Ve(),Be(null),re(!0)},ma=s=>{Be(s),K({name:s.name||"",description:s.description||"",currencyAmount:s.currencyAmount?.toString()||"",priceUSD:s.priceUSD||"",bonusPercentage:s.bonusPercentage?.toString()||"0",isActive:s.isActive||"true",displayOrder:s.displayOrder?.toString()||"0"}),re(!0)},xa=()=>{const s={name:v.name,description:v.description,currencyAmount:parseInt(v.currencyAmount),priceUSD:v.priceUSD,bonusPercentage:parseInt(v.bonusPercentage),isActive:v.isActive,displayOrder:parseInt(v.displayOrder)};fe?aa.mutate({id:fe.id,data:s}):sa.mutate(s)},ha=()=>{ze(),Ie(null),ne(!0)},pa=s=>{Ie(s),F({name:s.name||"",description:s.description||"",priceUSD:s.priceUSD||"",billingCycle:s.billingCycle||"monthly",features:Array.isArray(s.features)?s.features.join(", "):s.features||"",coinBonus:s.coinBonus?.toString()||"0",discountPercentage:s.discountPercentage?.toString()||"0",isAdFree:s.isAdFree||"false",trialDays:s.trialDays?.toString()||"0",isActive:s.isActive||"true",displayOrder:s.displayOrder?.toString()||"0",stripePriceId:s.stripePriceId||""}),ne(!0)},ja=()=>{const s={name:i.name,description:i.description,priceUSD:i.priceUSD,billingCycle:i.billingCycle,features:i.features.split(",").map(a=>a.trim()).filter(a=>a),coinBonus:parseInt(i.coinBonus),discountPercentage:parseInt(i.discountPercentage),isAdFree:i.isAdFree,trialDays:parseInt(i.trialDays),isActive:i.isActive,displayOrder:parseInt(i.displayOrder),stripePriceId:i.stripePriceId||null};ye?ta.mutate({id:ye.id,data:s}):na.mutate(s)},ga=()=>{_e(),Oe(null),te(!0)},va=s=>{Oe(s),V({name:s.name||"",description:s.description||"",bundleType:s.bundleType||"currency",priceUSD:s.priceUSD||"",items:typeof s.items=="string"?s.items:JSON.stringify(s.items||[]),isActive:s.isActive||"true",displayOrder:s.displayOrder?.toString()||"0"}),te(!0)},fa=()=>{const s={name:f.name,description:f.description,bundleType:f.bundleType,priceUSD:f.priceUSD,items:f.items,isActive:f.isActive,displayOrder:parseInt(f.displayOrder)};be?la.mutate({id:be.id,data:s}):ca.mutate(s)},ya=async()=>{try{const s=new URLSearchParams;w.status&&w.status!=="all"&&s.append("status",w.status),w.packageId&&s.append("packageId",w.packageId),w.startDate&&s.append("startDate",w.startDate),w.endDate&&s.append("endDate",w.endDate);const a=await fetch(`/api/admin/subscribers?${s.toString()}`,{credentials:"include"});if(!a.ok){const Ca=(await a.json().catch(()=>null))?.message||`Server returned ${a.status}`;throw new Error(Ca)}const o=await a.blob(),z=window.URL.createObjectURL(o),_=document.createElement("a");_.href=z,_.download=`subscribers-${new Date().toISOString().split("T")[0]}.csv`,_.click(),n({title:"Success",description:"Subscribers exported successfully",variant:"success"})}catch(s){const a=s instanceof Error?s.message:"Failed to export subscribers";n({title:"Export Error",description:a,variant:"error"})}},vs=async()=>{if(!p.trim()){n({title:"Error",description:"Please enter a username to search",variant:"error"});return}try{const s=await fetch(`/api/admin/users/search?q=${encodeURIComponent(p)}`,{credentials:"include"});if(!s.ok)throw new Error("User not found");const a=await s.json();if(a.length===0){n({title:"Not Found",description:"No user found with that username",variant:"error"});return}const o=a[0];as(o.id),ns(o.username),Ue(o.currencyBalance||0),n({title:"User Found",description:`User: ${o.username} (Balance: ${o.currencyBalance||0} coins)`})}catch(s){n({title:"Error",description:s.message||"Failed to search user",variant:"error"})}},ba=async()=>{if(!je){n({title:"Error",description:"Please select a user first",variant:"error"});return}if(!ve||parseInt(ve)<=0){n({title:"Error",description:"Please enter a valid amount",variant:"error"});return}if(!Le.trim()){n({title:"Error",description:"Please provide a reason for this adjustment",variant:"error"});return}try{const s=await Va(),a=await fetch("/api/admin/currency/adjust",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":s},credentials:"include",body:JSON.stringify({userId:je,amount:ge==="add"?parseInt(ve):-parseInt(ve),reason:Le})});if(!a.ok){const z=await a.json().catch(()=>({}));throw new Error(z.message||"Failed to adjust balance")}const o=await a.json();n({title:"Success",description:`Balance ${ge==="add"?"added":"deducted"} successfully. New balance: ${o.newBalance} coins`,variant:"success"}),Ue(o.newBalance),se(!1),ts(""),is(""),h.invalidateQueries({queryKey:["admin-currency-transactions"]}),h.invalidateQueries({queryKey:["admin-detailed-users"]}),h.invalidateQueries({queryKey:["admin-user-transactions"]}),b&&b.id===je&&ls({...b,currencyBalance:o.newBalance}),js(),Js()}catch(s){n({title:"Error",description:s.message||"Failed to adjust balance",variant:"error"})}},Na=s=>{ls(s),ds(!0)},Pe=(s,a)=>{as(s.id),ns(s.username),Ue(s.currencyBalance),Te(a),se(!0)},Qe=s=>{ae===s?cs(Z==="asc"?"desc":"asc"):(Ts(s),cs("asc"))};if(!y||!N)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 flex items-center justify-center p-4",children:e.jsxs(m,{className:"max-w-md w-full bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(j,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Ee,{className:"w-8 h-8 text-primary"})}),e.jsx(g,{className:"text-2xl",children:"Admin Access Required"}),e.jsx(k,{className:"mt-2",children:"You need admin privileges to access monetization management"})]}),e.jsx(x,{children:e.jsx(t,{onClick:()=>l("/"),className:"w-full",children:"Return to Home"})})]})});if(Ms||qs||Rs)return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-8",children:[e.jsx(ys,{className:"h-12 w-96 mb-8"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[1,2,3,4].map(s=>e.jsx(ys,{className:"h-32"},s))})]});const wa={labels:us?.map(s=>s.date)||[],datasets:[{label:"Revenue ($)",data:us?.map(s=>s.revenue)||[],borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",tension:.4}]},Sa={labels:os?.map(s=>s.name)||[],datasets:[{label:"Sales Count",data:os?.map(s=>s.totalSales)||[],backgroundColor:["rgba(168, 85, 247, 0.8)","rgba(236, 72, 153, 0.8)","rgba(251, 146, 60, 0.8)","rgba(59, 130, 246, 0.8)"]}]};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-2 sm:p-4 md:p-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs(t,{variant:"ghost",onClick:()=>l("/admin"),className:"text-muted-foreground hover:text-primary mb-3 sm:mb-4 min-h-11 w-full sm:w-auto justify-start",children:[e.jsx(Ea,{className:"w-4 h-4 mr-2"}),"Back to Admin"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold",children:"Monetization Dashboard"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Complete revenue and monetization management"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["7d","30d","90d","1y"].map(s=>e.jsx(t,{variant:Y===s?"default":"outline",onClick:()=>A(s),size:"sm",className:"min-h-10",children:s==="1y"?"1 Year":s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6 mb-6 sm:mb-8",children:[e.jsxs(m,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:"Total Revenue"}),e.jsx(Ee,{className:"w-4 h-4 text-green-500"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["$",T?.totalRevenue?.toLocaleString()||"0"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:T?.revenueGrowth&&T.revenueGrowth>0?"text-green-500":"text-red-500",children:[T?.revenueGrowth&&T.revenueGrowth>0?"+":"",T?.revenueGrowth||0,"%"]})," from last period"]})]})]}),e.jsxs(m,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:"Active Subscriptions"}),e.jsx(dr,{className:"w-4 h-4 text-purple-500"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-3xl font-bold",children:T?.activeSubscriptions?.toLocaleString()||"0"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["$",T?.mrr?.toLocaleString()||"0"," MRR"]})]})]}),e.jsxs(m,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:"Coin Sales"}),e.jsx(Ne,{className:"w-4 h-4 text-amber-500"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["$",T?.coinSalesRevenue?.toLocaleString()||"0"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"One-time purchases"})]})]}),e.jsxs(m,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:"Flash Sales"}),e.jsx(or,{className:"w-4 h-4 text-red-500"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["$",T?.flashSalesRevenue?.toLocaleString()||"0"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Limited time offers"})]})]})]}),e.jsxs(Je,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(He,{className:"grid w-full grid-cols-4 lg:grid-cols-8",children:[e.jsx(L,{value:"overview",children:"Overview"}),e.jsx(L,{value:"packages",children:"Packages"}),e.jsx(L,{value:"coupons",children:"Coupons"}),e.jsx(L,{value:"subscribers",children:"Subscribers"}),e.jsx(L,{value:"invoices",children:"Invoices"}),e.jsx(L,{value:"assignments",children:"Assignments"}),e.jsx(L,{value:"reconciliation",children:"Reconciliation"}),e.jsx(L,{value:"currency",children:"Currency"})]}),e.jsxs(B,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Feature Controls"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Enable or disable monetization features"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ir,{}),e.jsx(gr,{})]})]}),e.jsx(Ge,{className:"my-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Revenue Trend"}),e.jsx(k,{children:"Revenue over time"})]}),e.jsx(x,{children:e.jsx(Ja,{data:wa,options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})})]}),e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Top Selling Packages"}),e.jsx(k,{children:"By sales volume"})]}),e.jsx(x,{children:e.jsx(Ha,{data:Sa,options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})})]})]}),e.jsxs(m,{children:[e.jsx(j,{children:e.jsx(g,{children:"Key Metrics"})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold",children:["$",T?.averageOrderValue?.toFixed(2)||"0"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Average Order Value"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold",children:[T?.conversionRate?.toFixed(1)||"0","%"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Conversion Rate"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold",children:["$",T?.monthlyRevenue?.toLocaleString()||"0"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This Month"})]})]})})]})]}),e.jsx(B,{value:"packages",className:"space-y-6",children:e.jsxs(Je,{defaultValue:"currency",className:"w-full",children:[e.jsxs(He,{className:"grid w-full grid-cols-3",children:[e.jsxs(L,{value:"currency",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Currency Packages"]}),e.jsxs(L,{value:"subscriptions",children:[e.jsx(ur,{className:"h-4 w-4 mr-2"}),"Subscriptions"]}),e.jsxs(L,{value:"bundles",children:[e.jsx(mr,{className:"h-4 w-4 mr-2"}),"Bundles"]})]}),e.jsx(B,{value:"currency",className:"space-y-4 mt-6",children:e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Currency Packages"}),e.jsx(k,{children:"Manage coin/point packages for sale"})]}),e.jsxs(t,{onClick:ua,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Create Package"]})]})}),e.jsx(x,{children:Me?e.jsx("p",{children:"Loading..."}):ie?.currency.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No currency packages created yet"}):e.jsx("div",{className:"space-y-2",children:ie?.currency.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.currencyAmount," coins - $",s.priceUSD,s.bonusPercentage>0&&` (+${s.bonusPercentage}% bonus)`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:s.isActive==="true"?"default":"secondary",children:s.isActive==="true"?"Active":"Inactive"}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>ma(s),children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>ra.mutate(s.id),children:e.jsx(we,{className:"h-4 w-4"})})]})]},s.id))})})]})}),e.jsx(B,{value:"subscriptions",className:"space-y-4 mt-6",children:e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Subscription Packages"}),e.jsx(k,{children:"Manage VIP/Premium memberships"})]}),e.jsxs(t,{onClick:ha,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Create Subscription"]})]})}),e.jsx(x,{children:Me?e.jsx("p",{children:"Loading..."}):ie?.subscriptions.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No subscription packages created yet"}):e.jsx("div",{className:"space-y-2",children:ie?.subscriptions.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["$",s.priceUSD,"/",s.billingCycle,s.trialDays>0&&` â€¢ ${s.trialDays} days trial`,s.coinBonus>0&&` â€¢ ${s.coinBonus} coins/month`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:s.isActive==="true"?"default":"secondary",children:s.isActive==="true"?"Active":"Inactive"}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>pa(s),children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>ia.mutate(s.id),children:e.jsx(we,{className:"h-4 w-4"})})]})]},s.id))})})]})}),e.jsx(B,{value:"bundles",className:"space-y-4 mt-6",children:e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Package Bundles"}),e.jsx(k,{children:"Special bundled offers"})]}),e.jsxs(t,{onClick:ga,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Create Bundle"]})]})}),e.jsx(x,{children:Me?e.jsx("p",{children:"Loading..."}):ie?.bundles.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No bundles created yet"}):e.jsx("div",{className:"space-y-2",children:ie?.bundles.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["$",s.priceUSD," â€¢ ",s.bundleType]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:s.isActive==="true"?"default":"secondary",children:s.isActive==="true"?"Active":"Inactive"}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>va(s),children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>da.mutate(s.id),children:e.jsx(we,{className:"h-4 w-4"})})]})]},s.id))})})]})})]})}),e.jsxs(B,{value:"coupons",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Coupon Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage discount codes"})]}),e.jsxs(t,{onClick:()=>R(!0),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Create Coupon"]})]}),e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Active Coupons"}),e.jsx(k,{children:"Manage discount codes for your users"})]}),e.jsx(x,{children:Ks?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"space-y-2",children:$s?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(jr,{className:"h-4 w-4"}),e.jsx("h3",{className:"font-semibold",children:s.code}),e.jsx(E,{variant:s.isActive==="true"?"default":"secondary",children:s.isActive==="true"?"Active":"Inactive"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[s.type==="percentage"?`${s.value}% off`:`$${s.value} off`,s.minPurchaseAmount&&` â€¢ Min: $${s.minPurchaseAmount}`,s.maxUses&&` â€¢ ${s.currentUses}/${s.maxUses} used`]})]}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>Ys.mutate(s.id),children:e.jsx(we,{className:"h-4 w-4"})})]},s.id))})})]})]}),e.jsxs(B,{value:"subscribers",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Subscribers"}),e.jsx("p",{className:"text-muted-foreground",children:"View and export subscriber data"})]}),e.jsxs(t,{onClick:ya,children:[e.jsx(ws,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Export Filters"}),e.jsx(k,{children:"Filter subscribers before exporting"})]}),e.jsxs(x,{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Status"}),e.jsxs(I,{value:w.status,onValueChange:s=>he({...w,status:s}),children:[e.jsx(O,{children:e.jsx(M,{placeholder:"All statuses"})}),e.jsxs(q,{children:[e.jsx(d,{value:"all",children:"All"}),e.jsx(d,{value:"active",children:"Active"}),e.jsx(d,{value:"cancelled",children:"Cancelled"}),e.jsx(d,{value:"expired",children:"Expired"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Start Date"}),e.jsx(u,{type:"date",value:w.startDate,onChange:s=>he({...w,startDate:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(r,{children:"End Date"}),e.jsx(u,{type:"date",value:w.endDate,onChange:s=>he({...w,endDate:s.target.value})})]})]})]}),e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsx(Ye,{className:"inline h-5 w-5 mr-2"}),"Subscriber Information"]}),e.jsx(k,{children:'Use the filters above and click "Export CSV" to download subscriber data'})]}),e.jsx(x,{children:e.jsx("p",{className:"text-muted-foreground",children:"The exported CSV will include: User ID, Username, Email, Package Name, Status, Trial Info, and Subscription Dates"})})]})]}),e.jsxs(B,{value:"invoices",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Invoices"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage invoices"})]}),e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"All Invoices"}),e.jsx(k,{children:"Purchase and subscription invoices"})]}),e.jsx(x,{children:Vs?e.jsx("p",{children:"Loading..."}):ms?.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No invoices found"}):e.jsx("div",{className:"space-y-2",children:ms?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xr,{className:"h-4 w-4"}),e.jsx("h3",{className:"font-semibold",children:s.invoiceNumber}),e.jsx(E,{variant:s.status==="paid"?"default":"secondary",children:s.status})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Total: $",s.finalAmount,s.discountAmount!=="0.00"&&` (Discount: $${s.discountAmount})`]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs(t,{size:"sm",onClick:()=>Zs.mutate(s.id),children:[e.jsx(ws,{className:"h-4 w-4 mr-2"}),"PDF"]})]},s.id))})})]})]}),e.jsxs(B,{value:"assignments",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Manual Assignments"}),e.jsx("p",{className:"text-muted-foreground",children:"Manually assign packages to users"})]}),e.jsxs(t,{onClick:()=>ee(!0),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Assign Package"]})]}),e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Active Assignments"}),e.jsx(k,{children:"Manually assigned packages"})]}),e.jsx(x,{children:zs?e.jsx("p",{children:"Loading..."}):xs?.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No manual assignments yet"}):e.jsx("div",{className:"space-y-2",children:xs?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ua,{className:"h-4 w-4"}),e.jsxs("h3",{className:"font-semibold",children:["User: ",s.userId]}),e.jsx(E,{variant:s.isActive==="true"?"default":"secondary",children:s.isActive==="true"?"Active":"Revoked"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Type: ",s.packageType," â€¢ Reason: ",s.reason,s.expiresAt&&` â€¢ Expires: ${new Date(s.expiresAt).toLocaleDateString()}`]})]}),s.isActive==="true"&&e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>Xs.mutate(s.id),children:e.jsx(we,{className:"h-4 w-4"})})]},s.id))})})]})]}),e.jsxs(B,{value:"reconciliation",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Purchase Reconciliation"}),e.jsx("p",{className:"text-muted-foreground",children:"Reconcile offline and pending purchases"})]}),e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Offline Purchases"}),e.jsx(k,{children:"Purchases marked as offline need reconciliation"})]}),e.jsx(x,{children:_s?e.jsx("p",{children:"Loading..."}):hs?.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(hr,{className:"h-12 w-12 mx-auto text-green-500 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"All purchases reconciled! No pending items."})]}):e.jsx("div",{className:"space-y-2",children:hs?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ta,{className:"h-4 w-4 text-orange-500"}),e.jsxs("h3",{className:"font-semibold",children:["Purchase #",s.id.slice(0,8)]}),e.jsx(E,{variant:"secondary",children:s.status}),e.jsx(E,{variant:"destructive",children:"Offline"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["User: ",s.userId," â€¢ Amount: $",s.amountPaid," â€¢ Coins: ",s.currencyReceived]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Provider: ",s.paymentProvider," â€¢ ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs(t,{size:"sm",onClick:()=>ea.mutate(s.id),children:[e.jsx(bs,{className:"h-4 w-4 mr-2"}),"Reconcile"]})]},s.id))})})]})]}),e.jsxs(B,{value:"currency",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Currency Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user balances and chapter pricing"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Distributed"}),e.jsx("p",{className:"text-2xl font-bold",children:Re?"...":(qe?.totalDistributed||0).toLocaleString()})]}),e.jsx(Ee,{className:"w-8 h-8 text-primary"})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Spent"}),e.jsx("p",{className:"text-2xl font-bold",children:Re?"...":(qe?.totalSpent||0).toLocaleString()})]}),e.jsx(La,{className:"w-8 h-8 text-accent"})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold",children:Re?"...":(qe?.activeUsers||0).toLocaleString()})]}),e.jsx(Ye,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Transactions"}),e.jsx("p",{className:"text-2xl font-bold",children:ps?"...":(De?.length||0).toLocaleString()})]}),e.jsx(pr,{className:"w-8 h-8 text-purple-500"})]})})})]}),e.jsxs(Je,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(He,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsx(L,{value:"overview",children:"Overview"}),e.jsx(L,{value:"users",children:"Users"})]}),e.jsx(B,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5"}),"Adjust User Balance"]}),e.jsx(k,{children:"Search for a user and adjust their currency balance"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(r,{htmlFor:"search",children:"Username"}),e.jsx(u,{id:"search",placeholder:"Enter username...",value:p,onChange:s=>J(s.target.value),onKeyDown:s=>s.key==="Enter"&&vs()})]}),e.jsxs(t,{onClick:vs,className:"mt-auto",children:[e.jsx(Ba,{className:"w-4 h-4 mr-2"}),"Search"]})]}),je&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:rs}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["User ID: ",je]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Balance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary"}),e.jsx("p",{className:"text-2xl font-bold",children:Ds})]})]})]}),e.jsx(Ge,{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{onClick:()=>{Te("add"),se(!0)},className:"flex-1",variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Add Coins"]}),e.jsxs(t,{onClick:()=>{Te("deduct"),se(!0)},className:"flex-1",variant:"outline",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"Deduct Coins"]})]})]})]})]}),e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-5 h-5"}),"Transaction Log"]}),e.jsxs(t,{size:"sm",variant:"outline",onClick:()=>js(),children:[e.jsx(bs,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),e.jsx(k,{children:"Recent currency transactions and adjustments"})]}),e.jsx(x,{children:ps?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Loading transactions..."}):!De||De.length===0?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No transactions found"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:De.map(s=>e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.username}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reason}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(s.createdAt).toLocaleString()})]}),e.jsxs(E,{variant:s.amount>0?"default":"secondary",className:s.amount>0?"bg-green-500":"bg-red-500",children:[s.amount>0?"+":"",s.amount," coins"]})]})},s.id))})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Ia,{className:"w-5 h-5"}),"Quick Actions"]})}),e.jsxs(x,{className:"space-y-3",children:[e.jsxs(t,{onClick:()=>l("/admin/chapter-access"),variant:"outline",className:"w-full justify-start",children:[e.jsx(Oa,{className:"w-4 h-4 mr-2"}),"Chapter Access Control"]}),e.jsxs(t,{onClick:()=>l("/shop"),variant:"outline",className:"w-full justify-start",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"View Shop"]})]})]})})]})}),e.jsx(B,{value:"users",className:"space-y-6",children:e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"User Management"}),e.jsx(k,{children:"View and manage user currency balances"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Search Users"}),e.jsx(u,{placeholder:"Search by username or email...",value:Ce,onChange:s=>Fs(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Filter by Role"}),e.jsxs(I,{value:ke,onValueChange:Es,children:[e.jsx(O,{children:e.jsx(M,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"all",children:"All Roles"}),e.jsx(d,{value:"user",children:"User"}),e.jsx(d,{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Filter by Membership"}),e.jsxs(I,{value:Ae,onValueChange:Us,children:[e.jsx(O,{children:e.jsx(M,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"all",children:"All"}),e.jsx(d,{value:"vip",children:"VIP Only"}),e.jsx(d,{value:"none",children:"No Subscription"})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsx("div",{className:"overflow-hidden",children:e.jsxs(za,{children:[e.jsx(_a,{children:e.jsxs(Fe,{children:[e.jsx(Se,{onClick:()=>Qe("username"),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Username",ae==="username"&&(Z==="asc"?e.jsx(Ze,{className:"w-4 h-4"}):e.jsx(We,{className:"w-4 h-4"}))]})}),e.jsx(Se,{onClick:()=>Qe("role"),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Role",ae==="role"&&(Z==="asc"?e.jsx(Ze,{className:"w-4 h-4"}):e.jsx(We,{className:"w-4 h-4"}))]})}),e.jsx(Se,{onClick:()=>Qe("balance"),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Balance",ae==="balance"&&(Z==="asc"?e.jsx(Ze,{className:"w-4 h-4"}):e.jsx(We,{className:"w-4 h-4"}))]})}),e.jsx(Se,{children:"Subscription"}),e.jsx(Se,{children:"Actions"})]})}),e.jsx(Qa,{children:Qs?e.jsx(Fe,{children:e.jsx(X,{colSpan:5,className:"text-center",children:"Loading..."})}):gs.length===0?e.jsx(Fe,{children:e.jsx(X,{colSpan:5,className:"text-center text-muted-foreground",children:"No users found"})}):gs.map(s=>e.jsxs(Fe,{className:"cursor-pointer",onClick:()=>Na(s),children:[e.jsx(X,{className:"font-medium",children:s.username}),e.jsx(X,{children:e.jsx(E,{variant:s.isAdmin?"default":"secondary",children:s.role})}),e.jsx(X,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4 text-primary"}),s.currencyBalance]})}),e.jsx(X,{children:s.subscription?e.jsx(E,{variant:"outline",children:s.subscription.packageName}):e.jsx("span",{className:"text-muted-foreground",children:"None"})}),e.jsx(X,{children:e.jsxs("div",{className:"flex gap-1",onClick:a=>a.stopPropagation(),children:[e.jsx(t,{size:"sm",variant:"outline",onClick:()=>Pe(s,"add"),children:e.jsx(G,{className:"w-3 h-3"})}),e.jsx(t,{size:"sm",variant:"outline",onClick:()=>Pe(s,"deduct"),children:e.jsx(es,{className:"w-3 h-3"})})]})})]},s.id))})]})})})})]})]})})]})]})]})]}),e.jsx(ce,{open:xe,onOpenChange:R,children:e.jsxs(le,{className:"w-[95vw] max-w-lg",children:[e.jsxs(de,{children:[e.jsx(oe,{children:"Create Coupon"}),e.jsx(ue,{children:"Create a new discount coupon"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Code"}),e.jsx(u,{value:D.code,onChange:s=>$({...D,code:s.target.value.toUpperCase()}),placeholder:"SUMMER2025"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Type"}),e.jsxs(I,{value:D.type,onValueChange:s=>$({...D,type:s}),children:[e.jsx(O,{children:e.jsx(M,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"percentage",children:"Percentage"}),e.jsx(d,{value:"fixed",children:"Fixed Amount"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Value"}),e.jsx(u,{type:"number",value:D.value,onChange:s=>$({...D,value:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Min Purchase Amount (optional)"}),e.jsx(u,{type:"number",value:D.minPurchaseAmount,onChange:s=>$({...D,minPurchaseAmount:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Max Uses (optional)"}),e.jsx(u,{type:"number",value:D.maxUses,onChange:s=>$({...D,maxUses:s.target.value})})]})]}),e.jsxs(me,{children:[e.jsx(t,{variant:"outline",onClick:()=>R(!1),children:"Cancel"}),e.jsx(t,{onClick:()=>Gs.mutate(D),children:"Create"})]})]})}),e.jsx(ce,{open:pe,onOpenChange:ee,children:e.jsxs(le,{className:"w-[95vw] max-w-lg",children:[e.jsxs(de,{children:[e.jsx(oe,{children:"Assign Package"}),e.jsx(ue,{children:"Manually assign a package to a user"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"User ID"}),e.jsx(u,{value:S.userId,onChange:s=>Q({...S,userId:s.target.value}),placeholder:"User ID"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Package Type"}),e.jsxs(I,{value:S.packageType,onValueChange:s=>Q({...S,packageType:s}),children:[e.jsx(O,{children:e.jsx(M,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"currency",children:"Currency Package"}),e.jsx(d,{value:"subscription",children:"Subscription"}),e.jsx(d,{value:"bundle",children:"Bundle"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Package ID"}),e.jsx(u,{value:S.packageId,onChange:s=>Q({...S,packageId:s.target.value}),placeholder:"Package ID"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Reason"}),e.jsx(W,{value:S.reason,onChange:s=>Q({...S,reason:s.target.value}),placeholder:"Reason for assignment"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Expiration Date (optional)"}),e.jsx(u,{type:"datetime-local",value:S.expiresAt,onChange:s=>Q({...S,expiresAt:s.target.value})})]})]}),e.jsxs(me,{children:[e.jsx(t,{variant:"outline",onClick:()=>ee(!1),children:"Cancel"}),e.jsx(t,{onClick:()=>Ws.mutate(S),children:"Assign"})]})]})}),e.jsx(ce,{open:Bs,onOpenChange:re,children:e.jsxs(le,{className:"w-[95vw] max-w-lg",children:[e.jsxs(de,{children:[e.jsxs(oe,{children:[fe?"Edit":"Create"," Currency Package"]}),e.jsxs(ue,{children:[fe?"Update":"Create a new"," currency package"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Name"}),e.jsx(u,{value:v.name,onChange:s=>K({...v,name:s.target.value}),placeholder:"Starter Pack"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Description"}),e.jsx(W,{value:v.description,onChange:s=>K({...v,description:s.target.value}),placeholder:"Perfect for getting started"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Currency Amount"}),e.jsx(u,{type:"number",value:v.currencyAmount,onChange:s=>K({...v,currencyAmount:s.target.value}),placeholder:"100"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Price (USD)"}),e.jsx(u,{type:"number",step:"0.01",value:v.priceUSD,onChange:s=>K({...v,priceUSD:s.target.value}),placeholder:"9.99"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Bonus Percentage"}),e.jsx(u,{type:"number",value:v.bonusPercentage,onChange:s=>K({...v,bonusPercentage:s.target.value}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Display Order"}),e.jsx(u,{type:"number",value:v.displayOrder,onChange:s=>K({...v,displayOrder:s.target.value}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Active"}),e.jsxs(I,{value:v.isActive,onValueChange:s=>K({...v,isActive:s}),children:[e.jsx(O,{children:e.jsx(M,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"true",children:"Active"}),e.jsx(d,{value:"false",children:"Inactive"})]})]})]})]}),e.jsxs(me,{children:[e.jsx(t,{variant:"outline",onClick:()=>re(!1),children:"Cancel"}),e.jsx(t,{onClick:xa,children:fe?"Update":"Create"})]})]})}),e.jsx(ce,{open:Is,onOpenChange:ne,children:e.jsxs(le,{className:"w-[95vw] max-w-2xl",children:[e.jsxs(de,{children:[e.jsxs(oe,{children:[ye?"Edit":"Create"," Subscription"]}),e.jsxs(ue,{children:[ye?"Update":"Create a new"," subscription package"]})]}),e.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Name"}),e.jsx(u,{value:i.name,onChange:s=>F({...i,name:s.target.value}),placeholder:"Basic VIP"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Description"}),e.jsx(W,{value:i.description,onChange:s=>F({...i,description:s.target.value}),placeholder:"Access to exclusive content"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Price (USD)"}),e.jsx(u,{type:"number",step:"0.01",value:i.priceUSD,onChange:s=>F({...i,priceUSD:s.target.value}),placeholder:"9.99"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Billing Cycle"}),e.jsxs(I,{value:i.billingCycle,onValueChange:s=>F({...i,billingCycle:s}),children:[e.jsx(O,{children:e.jsx(M,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"monthly",children:"Monthly"}),e.jsx(d,{value:"yearly",children:"Yearly"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Features (comma separated)"}),e.jsx(W,{value:i.features,onChange:s=>F({...i,features:s.target.value}),placeholder:"Ad-free reading, Early access, Exclusive badges"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Stripe Price ID (optional)"}),e.jsx(u,{value:i.stripePriceId,onChange:s=>F({...i,stripePriceId:s.target.value}),placeholder:"price_xxxxx"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Leave empty to auto-create when Stripe integration is configured"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Monthly Coin Bonus"}),e.jsx(u,{type:"number",value:i.coinBonus,onChange:s=>F({...i,coinBonus:s.target.value}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Discount % on Purchases"}),e.jsx(u,{type:"number",value:i.discountPercentage,onChange:s=>F({...i,discountPercentage:s.target.value}),placeholder:"0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Trial Days"}),e.jsx(u,{type:"number",value:i.trialDays,onChange:s=>F({...i,trialDays:s.target.value}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Display Order"}),e.jsx(u,{type:"number",value:i.displayOrder,onChange:s=>F({...i,displayOrder:s.target.value}),placeholder:"0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Ad-Free"}),e.jsxs(I,{value:i.isAdFree,onValueChange:s=>F({...i,isAdFree:s}),children:[e.jsx(O,{children:e.jsx(M,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"true",children:"Yes"}),e.jsx(d,{value:"false",children:"No"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Active"}),e.jsxs(I,{value:i.isActive,onValueChange:s=>F({...i,isActive:s}),children:[e.jsx(O,{children:e.jsx(M,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"true",children:"Active"}),e.jsx(d,{value:"false",children:"Inactive"})]})]})]})]})]}),e.jsxs(me,{children:[e.jsx(t,{variant:"outline",onClick:()=>ne(!1),children:"Cancel"}),e.jsx(t,{onClick:ja,children:ye?"Update":"Create"})]})]})}),e.jsx(ce,{open:Os,onOpenChange:te,children:e.jsxs(le,{className:"w-[95vw] max-w-lg",children:[e.jsxs(de,{children:[e.jsxs(oe,{children:[be?"Edit":"Create"," Bundle"]}),e.jsxs(ue,{children:[be?"Update":"Create a new"," package bundle"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Name"}),e.jsx(u,{value:f.name,onChange:s=>V({...f,name:s.target.value}),placeholder:"Mega Pack"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Description"}),e.jsx(W,{value:f.description,onChange:s=>V({...f,description:s.target.value}),placeholder:"Best value bundle"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Bundle Type"}),e.jsxs(I,{value:f.bundleType,onValueChange:s=>V({...f,bundleType:s}),children:[e.jsx(O,{children:e.jsx(M,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"currency",children:"Currency"}),e.jsx(d,{value:"subscription",children:"Subscription"}),e.jsx(d,{value:"chapter",children:"Chapter"}),e.jsx(d,{value:"mixed",children:"Mixed"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Price (USD)"}),e.jsx(u,{type:"number",step:"0.01",value:f.priceUSD,onChange:s=>V({...f,priceUSD:s.target.value}),placeholder:"19.99"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Items (JSON format)"}),e.jsx(W,{value:f.items,onChange:s=>V({...f,items:s.target.value}),placeholder:'[{"type":"currency","amount":500},{"type":"chapter","id":"123"}]'})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Display Order"}),e.jsx(u,{type:"number",value:f.displayOrder,onChange:s=>V({...f,displayOrder:s.target.value}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Active"}),e.jsxs(I,{value:f.isActive,onValueChange:s=>V({...f,isActive:s}),children:[e.jsx(O,{children:e.jsx(M,{})}),e.jsxs(q,{children:[e.jsx(d,{value:"true",children:"Active"}),e.jsx(d,{value:"false",children:"Inactive"})]})]})]})]}),e.jsxs(me,{children:[e.jsx(t,{variant:"outline",onClick:()=>te(!1),children:"Cancel"}),e.jsx(t,{onClick:fa,children:be?"Update":"Create"})]})]})}),e.jsx(ce,{open:Ps,onOpenChange:se,children:e.jsxs(le,{className:"w-[95vw] max-w-lg",children:[e.jsxs(de,{children:[e.jsxs(oe,{children:[ge==="add"?"Add":"Deduct"," Coins"]}),e.jsxs(ue,{children:[ge==="add"?"Add coins to":"Deduct coins from"," ",rs,"'s balance"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Amount"}),e.jsx(u,{type:"number",placeholder:"Enter amount...",value:ve,onChange:s=>ts(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Reason"}),e.jsx(W,{placeholder:"Reason for adjustment...",value:Le,onChange:s=>is(s.target.value)})]})]}),e.jsxs(me,{children:[e.jsx(t,{variant:"outline",onClick:()=>se(!1),children:"Cancel"}),e.jsx(t,{onClick:ba,children:ge==="add"?"Add Coins":"Deduct Coins"})]})]})}),e.jsx(Ma,{open:Ls,onOpenChange:ds,children:e.jsxs(qa,{className:"w-full sm:max-w-lg",children:[e.jsxs(Ra,{children:[e.jsx($a,{children:"User Details"}),e.jsx(Ka,{children:b?.username})]}),b&&e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-sm",children:b.email||"Not provided"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground",children:"Role"}),e.jsx("div",{className:"mt-1",children:e.jsx(E,{variant:b.isAdmin?"default":"secondary",children:b.role})})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground",children:"Currency Balance"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary"}),e.jsx("p",{className:"text-2xl font-bold",children:b.currencyBalance})]})]}),b.subscription&&e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground",children:"Subscription"}),e.jsxs("div",{className:"mt-2 p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"font-medium",children:b.subscription.packageName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",e.jsx(E,{variant:"outline",children:b.subscription.status})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[new Date(b.subscription.currentPeriodStart).toLocaleDateString()," - ",new Date(b.subscription.currentPeriodEnd).toLocaleDateString()]})]})]})]}),e.jsx(Ge,{}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Transaction History"]}),Hs?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."}):!Ke||Ke.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No transactions"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Ke.map(s=>e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg text-sm",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.reason}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(s.createdAt).toLocaleString()})]}),e.jsxs(E,{variant:s.amount>0?"default":"secondary",className:s.amount>0?"bg-green-500":"bg-red-500",children:[s.amount>0?"+":"",s.amount]})]})},s.id))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{className:"flex-1",onClick:()=>{Pe(b,"add")},children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Add Coins"]}),e.jsxs(t,{className:"flex-1",variant:"outline",onClick:()=>{Pe(b,"deduct")},children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"Deduct Coins"]})]})]})]})})]})}export{Wr as default};
